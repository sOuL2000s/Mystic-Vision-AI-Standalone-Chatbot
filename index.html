<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Vision AI Chat</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN for utility classes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js CDN for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Lucide Icons for a modern, futuristic feel -->
    <script src="https://cdn.jsdelivr.net/npm/lucide-dynamic@latest/dist/lucide.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <style>
        /* General Styles - Mystic Vision Theme */
        :root {
            /* Dark Mode Palette (Default) */
            --primary-bg: #0C0C2F; /* Very dark blue-purple */
            --secondary-bg: #1B1B4A; /* Darker purple-blue - container background */
            --tertiary-bg: #2B2B60; /* Medium dark purple-blue - header/input area/button base */
            --text-color: #E0E0E0; /* Light grey text */
            --accent-color: #C070FF; /* Vibrant mystical purple */
            --border-color: #2B2B60;
            --user-bubble: #3A3A75; /* Deeper purple for user */
            --ai-bubble: #1F1F50; /* Slightly different dark purple for AI */
            --input-bg: #0C0C2F;
            --button-hover-bg: #A040FF; /* Slightly darker accent for hover */
            --shadow-color: rgba(0, 0, 0, 0.5); /* Stronger shadow */
            --code-bg: #0F0F3D; /* Code block background */
            --code-text: #f8f8f2; /* Code text color */
            --code-border: #2B2B60; /* Code border */
            --code-header-bg: #2B2B60; /* Code header background */
            --code-header-border: #3A3A75; /* Code header border */
            --inline-code-bg: rgba(192, 112, 255, 0.2); /* Inline code background */
            --inline-code-color: var(--accent-color); /* Inline code color */
            --message-action-bg: rgba(19, 19, 26, 0.6); /* Message action background */
            --message-action-user-bg: rgba(58, 58, 117, 0.6); /* Message action background for user messages */
            --message-action-icon: #9ca3af; /* Message action icon color */
            --message-action-icon-hover: var(--text-color); /* Message action icon hover color */

            /* Common Accent Colors (for alerts/status) */         
            --accent-error: #ef4444; /* Red for errors */         
            --accent-success: #22c55e; /* Green for success */          

            /* Font Families */         
            --font-family-primary: 'Poppins', sans-serif;         
            --font-family-secondary: 'Montserrat', sans-serif;          

            /* Autocomplete */
            --autocomplete-bg: var(--secondary-bg);
            --autocomplete-border: var(--border-color);
            --autocomplete-text: var(--text-color);
            --autocomplete-hover-bg: var(--tertiary-bg);
            --autocomplete-selected-bg: var(--accent-color);
            --autocomplete-selected-text: white;
        }

        /* Light Mode Palette (Overrides default variables when body has 'light' class) */
        body.light {
            --primary-bg: #F8F4FF; /* Very pale lavender-white for main background */
            --secondary-bg: #FFFFFF; /* Pure white for container/card background */
            --tertiary-bg: #EAE6FF; /* Pale light purple for header/input area/button base */
            --text-color: #1A0033; /* Very dark purple/black for main text */
            --accent-color: #8C2BFF; /* Slightly richer/darker purple for light mode accent */
            --border-color: #D8D0E0; /* Soft light purple border */
            --user-bubble: #D8E2FF; /* Light blue-purple, user bubble */
            --ai-bubble: #F0E8FF; /* Even paler lavender, AI bubble */
            --input-bg: #F8F8F8; /* Slightly off-white for input field */
            --button-hover-bg: #B050FF; /* Slightly darker accent for hover in light mode */
            --shadow-color: rgba(0, 0, 0, 0.15); /* Lighter shadow */
            --code-bg: #F0F0F5; /* Lighter background for code in light mode */
            --code-text: #333; /* Code text color */
            --code-border: #E0E0E5; /* Code border */
            --code-header-bg: #E0E0E5; /* Code header background */
            --code-header-border: #D0D0D5; /* Code header border */
            --inline-code-bg: rgba(130, 0, 200, 0.1); /* Inline code background (LM accent with transparency) */
            --inline-code-color: var(--accent-color); /* Inline code color */
            --message-action-bg: rgba(255, 255, 255, 0.7); /* Message action background */
            --message-action-user-bg: rgba(220, 230, 255, 0.7); /* Message action background for user messages */
            --message-action-icon: #666; /* Message action icon color */
            --message-action-icon-hover: var(--text-color); /* Message action icon hover color */

            /* Autocomplete */
            --autocomplete-bg: var(--secondary-bg);
            --autocomplete-border: var(--border-color);
            --autocomplete-text: var(--text-color);
            --autocomplete-hover-bg: var(--tertiary-bg);
            --autocomplete-selected-bg: var(--accent-color);
            --autocomplete-selected-text: white;
        }

        /* Base Body Styles */
        body {
            font-family: var(--font-family-primary);
            background: linear-gradient(135deg, var(--primary-bg), var(--secondary-bg));
            color: var(--text-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background 0.6s ease, color 0.6s ease; /* Smooth transition for background gradient */
        }

        /* Chatbot Container (Main Application) */
        .chatbot-container {
            background-color: var(--secondary-bg);
            border-radius: 25px;
            box-shadow: 0 15px 30px var(--shadow-color);
            width: 90%;
            max-width: 700px; 
            height: 90vh; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid var(--border-color);
            animation: fadeIn 0.8s ease-out;
            position: relative; 
            transition: background-color 0.6s ease, border-color 0.6s ease, box-shadow 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .chatbot-header {
            background-color: var(--tertiary-bg);
            padding: 20px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
            border-top-left-radius: 23px;
            border-top-right-radius: 23px;
            position: relative;
            overflow: hidden;
            z-index: 10; 
            transition: background-color 0.6s ease, border-color 0.6s ease;
            display: flex; /* Added for alignment of items */
            align-items: center; /* Center items vertically */
            justify-content: center; /* Center items horizontally initially */
            flex-shrink: 0; /* Prevents header from shrinking */
        }
        
        .chatbot-header .header-content {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .chatbot-header h1 {
            margin: 0;
            font-size: 2em; 
            color: var(--accent-color);
            font-family: var(--font-family-secondary);
            font-weight: 600;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(192, 112, 255, 0.6);
            transition: color 0.6s ease, text-shadow 0.6s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .chatbot-header .logo {
            height: 2.5em; /* Adjust size as needed */
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 0 5px rgba(192, 112, 255, 0.5));
            transition: filter 0.6s ease;
        }


        .chatbot-header .tagline {
            font-family: var(--font-family-secondary);
            font-size: 0.9em;
            color: var(--text-color);
            opacity: 0.7;
            margin: 0;
            font-style: italic;
            transition: color 0.6s ease;
        }

        .chatbot-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(192, 112, 255, 0.15) 0%, transparent 70%);
            transform: rotate(45deg);
            animation: headerGlow 8s infinite alternate ease-in-out;
            z-index: 1;
            transition: background 0.6s ease;
        }

        @keyframes headerGlow {
            0% { transform: scale(0.8) rotate(0deg); opacity: 0.6; }
            50% { transform: scale(1.1) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0.8) rotate(360deg); opacity: 0.6; }
        }

        /* Dark Mode Toggle Switch */
        .dark-mode-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 3;
            font-family: var(--font-family-primary);
        }
        .dark-mode-container span {
            color: var(--text-color); 
            transition: color 0.6s ease;
        }

        .switch { 
            position: relative;
            display: inline-block;
            width: 56px; 
            height: 30px; 
            border-radius: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1); 
            transition: background-color 0.6s ease, border-color 0.6s ease;
        }
        .switch input { 
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider { 
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563; 
            border-radius: 15px; 
            transition: .4s;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; 
            width: 22px; 
            left: 4px;
            bottom: 4px;
            background-color: white; 
            border-radius: 50%;
            transition: .4s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        input:checked + .slider {
            background-color: var(--accent-color); 
        }
        input:checked + .slider:before {
            transform: translateX(26px); 
        }

        /* New Chat Button */
        #newChatBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: var(--accent-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-family: var(--font-family-primary);
            font-weight: 600;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.2s ease;
            z-index: 3;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        #newChatBtn:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-1px);
        }
        #newChatBtn:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        #newChatBtn .lucide {
            width: 1em;
            height: 1em;
        }

        /* Chat History */
        .chat-history {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        .chat-history::-webkit-scrollbar {
            width: 8px;
        }

        .chat-history::-webkit-scrollbar-track {
            background: var(--primary-bg); 
            border-radius: 10px;
            transition: background 0.6s ease;
        }

        .chat-history::-webkit-scrollbar-thumb {
            background-color: var(--accent-color); 
            border-radius: 10px;
            border: 2px solid var(--primary-bg); 
            transition: background-color 0.6s ease, border-color 0.6s ease;
        }

        /* Message Bubbles */
        .chat-message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            line-height: 1.5;
            word-wrap: break-word;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease-out;
            position: relative; 
            padding-bottom: 2.5rem; 
            font-size: 0.95rem; 
            transition: background-color 0.6s ease, color 0.6s ease, background-image 0.6s ease, box-shadow 0.6s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-message.user {
            background-color: var(--user-bubble);
            color: var(--text-color);
            margin-left: auto; /* Pushes user message to the right */
            border-bottom-right-radius: 5px; 
            background-image: linear-gradient(to bottom right, var(--user-bubble), color-mix(in srgb, var(--user-bubble) 80%, black 20%)); /* Dynamic darker shade */
        }

        .chat-message.ai {
            background-color: var(--ai-bubble);
            color: var(--text-color);
            margin-right: auto; /* Pushes AI message to the left */
            border-bottom-left-radius: 5px; 
            background-image: linear-gradient(to bottom left, var(--ai-bubble), color-mix(in srgb, var(--ai-bubble) 80%, black 20%)); /* Dynamic darker shade */
        }

        /* Markdown Styling within AI messages */
        .chat-message .message-content {
            padding: 0; 
            margin: 0;
        }
        .chat-message.ai .message-content p,
        .chat-message.ai .message-content ul,
        .chat-message.ai .message-content ol,
        .chat-message.ai .message-content h1,
        .chat-message.ai .message-content h2,
        .chat-message.ai .message-content h3,
        .chat-message.ai .message-content blockquote {
            margin-bottom: 1em;
            transition: color 0.6s ease; /* For changing heading colors */
        }
        .chat-message.ai .message-content h1,
        .chat-message.ai .message-content h2,
        .chat-message.ai .message-content h3 {
            color: var(--accent-color); /* Headings use accent color */
        }

        .chat-message.ai .message-content p:last-child,
        .chat-message.ai .message-content ul:last-child,
        .chat-message.ai .message-content ol:last-child,
        .chat-message.ai .message-content blockquote:last-child {
            margin-bottom: 0;
        }
        .chat-message.ai .message-content ul,
        .chat-message.ai .message-content ol {
            padding-left: 1.5em; 
        }
        .chat-message.ai .message-content li {
            margin-bottom: 0.5em;
        }
        .chat-message.ai .message-content strong {
            font-weight: bold;
            color: var(--accent-color); 
            transition: color 0.6s ease;
        }
        .chat-message.ai .message-content em {
            font-style: italic;
        }
        .chat-message.ai .message-content blockquote {
            border-left: 4px solid var(--accent-color); /* Blockquotes use accent color */
            color: var(--text-color); /* Main text color for readability */
            padding-left: 1em;
            margin-left: 0;
            transition: border-color 0.6s ease, color 0.6s ease;
        }

        /* Code block specific styling */
        .code-block-container {
            background-color: var(--code-bg); 
            color: var(--code-text); 
            border-radius: 0.75rem; 
            margin-top: 1rem;
            margin-bottom: 1rem;
            overflow: hidden; 
            border: 1px solid var(--code-border); 
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: background-color 0.6s ease, color 0.6s ease, border-color 0.6s ease;
        }
        .code-block-container pre {
            margin: 0; 
            padding: 1rem;
            overflow-x: auto; 
            font-family: 'Consolas', 'Fira Code', 'Cascadia Code', monospace; 
            font-size: 0.9em;
            line-height: 1.4;
        }
        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--code-header-bg); 
            color: var(--text-color); 
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--code-header-border);
            font-size: 0.85em;
            border-top-left-radius: 0.75rem;
            border-top-right-radius: 0.75rem;
            transition: background-color 0.6s ease, color 0.6s ease, border-color 0.6s ease;
        }
        .code-block-copy-button {
            background-color: transparent;
            border: none;
            color: var(--text-color); /* Code header text color */
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85em;
        }
        .code-block-copy-button:hover {
            background-color: color-mix(in srgb, var(--code-header-bg) 80%, white 20%); /* Lighter hover based on header */
            color: var(--text-color); 
        }
        /* Inline code */
        .chat-message.ai .message-content code:not(pre > code) {
            background-color: var(--inline-code-bg); 
            border-radius: 0.25rem;
            padding: 0.2em 0.4em;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            color: var(--inline-code-color); 
            transition: background-color 0.6s ease, color 0.6s ease;
        }
        /* Links */
        .chat-message.ai .message-content a {
            color: var(--accent-color);
            text-decoration: underline;
            transition: color 0.6s ease;
        }
        .chat-message.ai .message-content a:hover {
            color: var(--button-hover-bg); 
        }

        /* Message Action Buttons (Copy/Dictate) */
        .message-actions {
            position: absolute;
            bottom: 0.5rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.75rem;
            backdrop-filter: blur(5px);
            transition: opacity 0.3s ease;
            opacity: 0; 
            z-index: 10;
            background-color: var(--message-action-bg);
        }
        .chat-message:hover .message-actions {
            opacity: 1; 
        }
        .message-actions button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex; 
            align-items: center;
            justify-content: center;
        }
        .message-actions button .lucide { 
            color: var(--message-action-icon); 
            width: 1rem;
            height: 1rem;
            transition: color 0.6s ease;
        }
        .message-actions button:hover .lucide {
            color: var(--message-action-icon-hover); 
        }
        .message-actions button:hover {
            background-color: rgba(255, 255, 255, 0.1); 
        }
        .chat-message.user .message-actions {
            background-color: var(--message-action-user-bg);
        }
        /* Specific attachment preview styling within messages (not the input area ones) */
        .chat-message-attachment-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            background-color: var(--tertiary-bg); 
            color: var(--text-color); 
            font-size: 0.875rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: background-color 0.6s ease, color 0.6s ease, box-shadow 0.6s ease;
        }

        /* Input Area */
        .chat-input {
            padding: 20px;
            border-top: 2px solid var(--border-color);
            display: flex;
            gap: 10px; 
            align-items: end; 
            background-color: var(--tertiary-bg);
            border-bottom-left-radius: 23px;
            border-bottom-right-radius: 23px;
            position: relative; 
            transition: background-color 0.6s ease, border-color 0.6s ease;
            flex-shrink: 0; 
        }

        .chat-input textarea {
            flex-grow: 1;
            padding: 10px 15px; 
            border: 1px solid var(--border-color);
            border-radius: 25px;
            background-color: var(--input-bg);
            color: var(--text-color);
            font-family: var(--font-family-primary);
            font-size: 1em;
            resize: none;
            outline: none;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: border-color 0.3s ease, background-color 0.3s ease, color 0.6s ease;
            min-height: 40px; 
            height: auto; 
            overflow-y: hidden; 
        }

        .chat-input textarea:focus {
            border-color: var(--accent-color);
            background-color: color-mix(in srgb, var(--primary-bg) 90%, var(--tertiary-bg) 10%); /* Slightly lighter than primary bg */
        }

        /* Action buttons in input area (Send, Mic, Paperclip) */
        .chat-input .icon-button { 
            background-color: var(--tertiary-bg); 
            color: var(--text-color);
            border: none;
            border-radius: 50%; 
            width: 48px; 
            height: 48px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, color 0.6s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
            display: flex; 
            align-items: center;
            justify-content: center;
            flex-shrink: 0; 
        }

        .chat-input .icon-button:hover {
            background-color: var(--secondary-bg); 
            transform: translateY(-1px);
        }
        .chat-input .icon-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .chat-input .icon-button .lucide {
            width: 1.25em; 
            height: 1.25em;
        }

        #sendButton {
            background-color: var(--accent-color); 
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3); 
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }
        #sendButton:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-2px);
        }
        #sendButton:active {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* Loading Indicator */
        .loader-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        .loader-dot {
            width: 12px;
            height: 12px;
            margin: 0 4px;
            background-color: var(--accent-color);
            border-radius: 50%;
            display: inline-block;
            animation: bounce 1.4s infinite ease-in-out both;
            transition: background-color 0.6s ease;
        }
        .loader-dot:nth-child(1) { animation-delay: -0.32s; }
        .loader-dot:nth-child(2) { animation-delay: -0.16s; }
        .loader-dot:nth-child(3) { animation-delay: 0s; }
        
        @keyframes bounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1.0);
                opacity: 1;
            }
        }
        /* Voice input active state */
        .voice-input-active {
            background-color: var(--accent-error) !important; 
            animation: pulse-red 1s infinite cubic-bezier(0.4, 0, 0.6, 1);
        }
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
        }

        /* Attachment Preview (in input area) */
        .chat-image {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            margin-top: 0.5rem;
            display: block;
        }
        #chat-attachments-preview-container {
            background-color: var(--tertiary-bg);
            border-radius: 10px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            transition: background-color 0.6s ease, border-color 0.6s ease, box-shadow 0.6s ease;
        }
        .chat-attachment-preview-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            background-color: var(--secondary-bg); /* Use secondary for inner items */
            color: var(--text-color); 
            font-size: 0.875rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: background-color 0.6s ease, color 0.6s ease, box-shadow 0.6s ease;
        }
        .chat-attachment-preview-item .remove-attachment-btn {
            background: none;
            border: none;
            color: var(--accent-color); 
            cursor: pointer;
            padding: 0.1rem;
            border-radius: 50%;
            transition: background-color 0.2s ease, color 0.6s ease;
        }
        .chat-attachment-preview-item .remove-attachment-btn:hover {
            background-color: rgba(192, 112, 255, 0.2);
        }

        /* Drag and Drop visual feedback for chat window */
        .chatbot-container.drag-over-active {
            border: 2px dashed var(--accent-color);
            box-shadow: 0 0 20px var(--accent-color), 0 0 30px var(--accent-color) inset;
            transition: border-color 0.6s ease, box-shadow 0.6s ease;
        }

        /* Copy Message Toast */
        #copy-message {
            position: fixed;
            bottom: 3rem; 
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            background-color: var(--accent-success);
            color: white;
            border-radius: 9999px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease-in-out;
            z-index: 100;
        }

        #copy-message.show {
            opacity: 1;
            visibility: visible;
        }

        /* Autocomplete Suggestions */
        #suggestions-container {
            position: absolute;
            bottom: 100%; /* Position above the input field */
            left: 0;
            right: 0;
            margin-bottom: 10px; /* Space between input and suggestions */
            background-color: var(--autocomplete-bg);
            border: 1px solid var(--autocomplete-border);
            border-radius: 10px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.2);
            max-height: 200px;
            overflow-y: auto;
            z-index: 20; /* Ensure it's above other input elements */
            transition: background-color 0.6s ease, border-color 0.6s ease, box-shadow 0.6s ease;
        }
        #suggestions-container ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #suggestions-container li {
            padding: 10px 15px;
            cursor: pointer;
            color: var(--autocomplete-text);
            transition: background-color 0.2s ease, color 0.6s ease;
        }
        #suggestions-container li:hover,
        #suggestions-container li.selected {
            background-color: var(--autocomplete-hover-bg);
        }
        #suggestions-container li.selected {
            background-color: var(--autocomplete-selected-bg);
            color: var(--autocomplete-selected-text);
        }


        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .chatbot-container {
                width: 98%; /* Slightly wider on mobile */
                height: 98vh; /* Taller on mobile */
                border-radius: 15px;
                margin: 1vh auto; /* Center with a slight margin */
            }

            .chatbot-header {
                padding: 12px; /* Reduced padding */
                border-top-left-radius: 13px;
                border-top-right-radius: 13px;
                /* Re-adjusting flex properties to prevent overlapping */
                display: flex;
                flex-direction: column; /* Stack header content */
                align-items: center;
                gap: 5px; /* Gap between stacked elements */
            }
            .chatbot-header h1 {
                font-size: 1.6em; /* Smaller title */
                margin-top: 10px; /* Push title down a bit from buttons */
            }
            .chatbot-header .logo {
                height: 1.8em; /* Smaller logo */
            }
            .chatbot-header .tagline {
                font-size: 0.75em; /* Smaller tagline */
                margin-bottom: 5px; /* Space from content below */
            }

            .dark-mode-container {
                position: absolute; /* Keep absolute position */
                top: 10px;
                right: 10px;
                gap: 5px;
                font-size: 0.7em; /* Smaller font for "Light/Dark" */
            }
            .switch {
                width: 40px; /* Smaller switch */
                height: 22px;
                border-radius: 11px;
            }
            .switch .slider:before {
                height: 16px; /* Smaller slider circle */
                width: 16px;
                left: 3px;
                bottom: 3px;
            }
            input:checked + .slider:before {
                transform: translateX(18px); /* Adjust translate for smaller switch */
            }

            #newChatBtn {
                position: absolute; /* Keep absolute position */
                top: 10px;
                left: 10px;
                padding: 6px 10px; /* Smaller padding */
                font-size: 0.7em; /* Smaller font */
                gap: 3px; /* Smaller gap */
            }
            #newChatBtn .lucide {
                width: 0.7em;
                height: 0.7em;
            }

            .chat-history {
                padding: 10px; /* Reduced padding */
                gap: 8px; /* Reduced gap between messages */
            }

            .chat-message {
                max-width: 95%; /* Wider bubbles for smaller screens */
                padding: 10px 14px; /* Reduced padding */
                border-radius: 16px; /* Slightly smaller radius */
                padding-bottom: 2rem; /* Ensure space for actions */
                font-size: 0.88rem; /* Slightly smaller font for messages */
            }

            .message-actions {
                bottom: 0.3rem; 
                right: 0.6rem; /* Closer to edge */
                gap: 0.3rem;
                padding: 0.15rem 0.3rem; /* Smaller padding */
                border-radius: 0.5rem; /* Smaller radius */
            }
            .message-actions button {
                padding: 0.1rem;
            }
            .message-actions button .lucide {
                width: 0.8rem;
                height: 0.8rem;
            }

            .chat-input {
                padding: 10px;
                gap: 6px; /* Reduced gap */
                align-items: center; /* Vertically align items in input row */
                border-bottom-left-radius: 13px;
                border-bottom-right-radius: 13px;
                flex-wrap: wrap; /* Allow wrapping if attachments make it too wide */
            }

            .chat-input textarea {
                padding: 8px 12px; 
                font-size: 0.9em;
                min-height: 38px; /* Slightly more compact */
                max-height: 120px; /* Limit max height on mobile */
            }

            .chat-input .icon-button {
                width: 42px; /* Smaller buttons */
                height: 42px;
            }
            .chat-input .icon-button .lucide {
                width: 1em; /* Smaller icon */
                height: 1em;
            }

            #chat-attachments-preview-container {
                padding: 6px; /* Smaller padding */
                margin-bottom: 8px; /* Closer to input */
            }
            .chat-attachment-preview-item {
                font-size: 0.75em; /* Smaller font for attachments */
                padding: 0.3rem 0.5rem; /* Smaller padding */
                border-radius: 0.75rem; /* Smaller radius */
            }
            .chat-attachment-preview-item .remove-attachment-btn .lucide {
                width: 0.7rem;
                height: 0.7rem;
            }

            #copy-message {
                bottom: 1.5rem; /* Closer to bottom */
                padding: 0.5rem 1rem; /* Smaller padding */
                font-size: 0.85rem; /* Smaller font */
            }

            #suggestions-container {
                margin-bottom: 8px;
            }
            #suggestions-container li {
                padding: 8px 12px;
                font-size: 0.85em;
            }
        }
    </style>
</head>
<body class="antialiased dark">
    <div class="chatbot-container">
        <header class="chatbot-header">
            <button id="newChatBtn" title="Start a New Chat">
                <span data-lucide="sparkles" class="w-4 h-4"></span>
                New Chat
            </button>
            <div class="dark-mode-container">
                <span>Light</span>
                <label class="switch">
                    <input type="checkbox" id="dark-mode-toggle">
                    <span class="slider"></span>
                </label>
                <span>Dark</span>
            </div>
            <div class="header-content">
                <h1>
                    <img src="logo.png" alt="Mystic Vision AI Logo" class="logo">
                    Mystic Vision AI
                </h1>
                <p class="tagline">Experience the beyond</p>
            </div>
        </header>
        <div class="chat-history" id="chatHistory">
            <!-- Initial AI message will be added by JS -->
        </div>
        <div class="chat-input" id="chatInputArea">
            <!-- Autocomplete Suggestions Container -->
            <div id="suggestions-container" class="hidden">
                <ul id="suggestions-list"></ul>
            </div>

            <!-- Attachment preview -->
            <!-- Adjusted positioning to be absolute relative to chat-input with a calculated bottom -->
            <div id="chat-attachments-preview-container" class="mb-2 flex flex-wrap items-center gap-2 hidden absolute left-4 right-4" style="bottom: 100%; transform: translateY(-10px);">
                <!-- Attachments previews will be dynamically added here -->
            </div>

            <!-- Voice Input Button -->
            <button id="voice-input-btn" class="icon-button" aria-label="Voice Input">
                <span data-lucide="mic" class="w-5 h-5"></span>
            </button>

            <!-- Attach File Button (uses a label to link to the hidden file input) -->
            <label for="chat-image-upload" id="attach-file-btn" class="icon-button cursor-pointer" aria-label="Attach File">
                <span data-lucide="paperclip" class="w-5 h-5"></span>
            </label>
            <input type="file" id="chat-image-upload" accept="image/*, .txt, .pdf, .csv, .json, .xml, .md" class="hidden" multiple>

            <textarea id="userInput" placeholder="Type your message..." rows="1"></textarea>
            
            <!-- Send Button -->
            <button id="sendButton" class="icon-button">
                <span data-lucide="send" class="w-5 h-5"></span>
            </button>
        </div>
    </div>

    <!-- Temporary message for clipboard copy -->
    <div id="copy-message">Text copied to clipboard!</div>

    <script>
        // !! IMPORTANT: REPLACE WITH YOUR ACTUAL GEMINI API KEY !!
        // !! DO NOT USE THIS METHOD IN PRODUCTION. USE A SERVER-SIDE PROXY. !!
        // The key below is a placeholder and WILL NOT WORK.
        const GEMINI_API_KEY = 'AIzaSyC7twxprKoApUjR4uebBS-12KVyZTkuvrw'; // <--- REPLACE THIS WITH YOUR ACTUAL KEY
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;

        // --- Global State Variables and Constants ---
        let conversationHistory = []; // Will be initialized with the first AI message
        let chatAttachments = []; 
        const messageTextCache = new Map(); 
        let currentUtterance = null;
        let isSpeaking = false;
        let SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;
        let isVoiceInputActive = false;
        let finalTranscript = ''; 
        let selectedSuggestionIndex = -1;

        const initialAIMessage = {
            role: 'model',
            parts: [{ text: 'Greetings, seeker! I am Mystic Vision, an AI designed to help you glimpse the beyond. What wisdom do you seek?' }],
        };

        const autocompleteSuggestions = [
            // General/Utility
            "What is the capital of France?",
            "Explain quantum physics simply.",
            "How does a combustion engine work?",
            "Summarize the plot of Hamlet.",
            "What are the benefits of exercise?",
            "Calculate the square root of 144.",
            "Convert 50 miles to kilometers.",
            "Define artificial intelligence.",
            "What is blockchain technology?",
            "Explain the internet.",
            "Tell me about renewable energy.",
            "What are the phases of the moon?",
            "How do volcanoes erupt?",
            "What causes tides?",
            "What is the speed of light?",
            "How does photosynthesis work?",
            "What are the main types of clouds?",
            "Explain the concept of infinity.",
            "What is the difference between AI and machine learning?",
            "How does GPS work?",

            // Creative Writing/Ideas
            "Write a short story about a talking animal.",
            "Compose a poem about the ocean.",
            "Give me five ideas for a fantasy novel.",
            "Write a dialogue between a robot and a human.",
            "Generate a catchy slogan for a coffee shop.",
            "Describe a futuristic city.",
            "Create a character profile for a wizard.",
            "Write a fairy tale with a modern twist.",
            "Brainstorm names for a new tech startup.",
            "Suggest topics for a blog about travel.",
            "Write an exciting opening paragraph for an adventure story.",
            "Compose a haiku about autumn.",
            "Develop a plot for a sci-fi film.",
            "Write a humorous obituary.",
            "Describe a unique alien species.",

            // Programming/Tech Help
            "How to write a 'Hello, World!' program in Python?",
            "Explain asynchronous JavaScript.",
            "What is the best framework for web development?",
            "How to debug a Java application?",
            "Write a SQL query to select all users.",
            "Explain REST APIs.",
            "What is version control?",
            "How do I install Node.js?",
            "Explain recursion in programming.",
            "What are data structures?",
            "How to optimize a website for speed?",
            "Explain object-oriented programming.",
            "Write a simple HTML structure.",
            "What is cloud computing?",
            "How to secure a web application?",

            // Education/Learning
            "How to study effectively for exams?",
            "Tips for learning a new language.",
            "What are good resources for learning history?",
            "How to improve my public speaking skills?",
            "Suggest a good book for beginners in astrophysics.",
            "What are the benefits of lifelong learning?",
            "How to choose a university major?",
            "Explain critical thinking.",
            "What is metacognition?",
            "How to set SMART goals?",

            // Health/Wellness
            "What are the benefits of a balanced diet?",
            "Suggest a simple home workout routine.",
            "How to reduce stress naturally?",
            "What are common symptoms of flu?",
            "Explain the importance of sleep.",
            "Tips for maintaining mental health.",
            "What foods boost immunity?",
            "How to stay hydrated?",
            "What is mindfulness meditation?",
            "How to improve posture?",

            // Food/Cooking
            "Suggest a quick and healthy dinner recipe.",
            "How to bake a perfect chocolate chip cookie?",
            "What are common cooking herbs?",
            "Explain sous-vide cooking.",
            "Recipe for a vegan lasagna.",
            "How to make sourdough bread?",
            "Best way to store fresh produce.",

            // Travel/Culture
            "What are the top 5 tourist attractions in Rome?",
            "Suggest a budget-friendly travel destination.",
            "How to pack efficiently for a trip?",
            "Tell me about Japanese culture.",
            "What are some famous landmarks in India?",
            "Tips for solo travel.",
            "Explain local customs in Thailand.",

            // Self-Improvement/Productivity
            "How to build good habits?",
            "Tips for time management.",
            "How to overcome procrastination?",
            "Suggest ways to boost creativity.",
            "How to practice active listening?",
            "What are methods for conflict resolution?",
            "How to give constructive feedback?",

            // Environment/Sustainability
            "What is climate change?",
            "How to reduce my carbon footprint?",
            "Explain recycling processes.",
            "What is sustainable living?",
            "Tips for conserving water at home.",

            // Philosophical/Existential (keeping some of the original theme)
            "What is the meaning of life?",
            "How can I find inner peace?",
            "What is intuition?",
            "Explain the concept of enlightenment.",
            "What is the purpose of suffering?",
            "How can I connect with my higher self?",
            "What does synchronicity mean?",
            "Tell me about the law of attraction.",
            "How to cultivate compassion?",
            "What is the significance of dreams?",

            // And more... (Extensive additions)
            "Tell me a fun fact.",
            "What's the origin of the phrase 'break a leg'?",
            "Who invented the telephone?",
            "Explain the stock market.",
            "How to manage personal finances?",
            "What are common cybersecurity threats?",
            "Explain the concept of net neutrality.",
            "What is artificial general intelligence?",
            "How does facial recognition work?",
            "Tell me about virtual reality.",
            "What is augmented reality?",
            "Explain ethical AI.",
            "How to start a podcast?",
            "Tips for public speaking.",
            "What is imposter syndrome?",
            "How to build resilience?",
            "Explain the gig economy.",
            "What is CRISPR technology?",
            "How to make compost?",
            "What are the benefits of gardening?",
            "Tell me about Roman history.",
            "Explain the Cold War.",
            "What were the causes of World War II?",
            "Tell me about ancient Egypt.",
            "What is democracy?",
            "Explain socialism.",
            "What are human rights?",
            "How does voting work?",
            "What is diplomacy?",
            "Tell me about different types of governments.",
            "How does inflation affect the economy?",
            "What is GDP?",
            "Explain interest rates.",
            "What is a recession?",
            "How to save for retirement?",
            "What is compound interest?",
            "Tell me about different investment strategies.",
            "How to create a budget?",
            "What is credit score?",
            "Explain mortgages.",
            "What is insurance?",
            "How to write a resume?",
            "Tips for a job interview.",
            "How to negotiate salary?",
            "What are common career paths in tech?",
            "Explain emotional intelligence.",
            "How to build strong relationships?",
            "Tips for effective communication.",
            "How to handle difficult conversations?",
            "What is empathy?",
            "How to resolve conflict in relationships?",
            "Tell me about different personality types.",
            "What is positive psychology?",
            "How to practice self-care?",
            "What are the signs of burnout?",
            "How to improve focus and concentration?",
            "What is the Pomodoro Technique?",
            "Explain the Eisenhower Matrix.",
            "How to prioritize tasks?",
            "Tips for remote work productivity.",
            "What is digital minimalism?",
            "How to manage screen time?",
            "What are the benefits of digital detox?",
            "Explain the concept of 'flow state'.",
            "How to overcome creative blocks?",
            "What are different learning styles?",
            "Tips for active reading.",
            "How to write an essay?",
            "Explain plagiarism.",
            "What is citation?",
            "How to do research effectively?",
            "What are open educational resources?",
            "Explain the peer review process.",
            "What is gamification in education?",
            "How to teach children about money?",
            "Tips for teaching a new skill.",
            "What is the Socratic method?",
            "Explain experiential learning.",
            "How to foster curiosity?",
            "What is problem-based learning?",
            "Tell me about different teaching philosophies.",
            "How to create engaging presentations?",
            "What are Bloom's Taxonomy levels?",
            "Explain formative assessment.",
            "What is summative assessment?",
            "How to provide effective feedback to students?",
            "Tips for classroom management.",
            "What is differentiated instruction?",
            "How to support students with learning disabilities?",
            "Explain inclusive education.",
            "What is homeschooling?",
            "How to choose the right school?",
            "What are extracurricular activities?",
            "Explain project-based learning.",
            "What is inquiry-based learning?",
            "How to promote critical thinking in students?",
            "What are the benefits of collaborative learning?",
            "How to use technology effectively in education?",
            "Explain blended learning.",
            "What is flipped classroom?",
            "How to assess student performance fairly?",
            "Tips for parent-teacher communication.",
            "What is social-emotional learning?",
            "How to build self-esteem in children?",
            "Explain the growth mindset.",
            "How to encourage creativity in children?",
            "What are different parenting styles?",
            "Tips for dealing with teenage rebellion.",
            "How to foster independence in children?",
            "What is positive reinforcement?",
            "Explain attachment theory.",
            "How to handle sibling rivalry?",
            "Tips for raising resilient children.",
            "What is childhood development?",
            "How to support children's emotional well-being?",
            "Explain the concept of play-based learning.",
            "What are the benefits of outdoor play?",
            "How to choose age-appropriate toys?",
            "What is early childhood education?",
            "Tips for preparing children for kindergarten.",
            "How to teach children to read?",
            "Explain phonics.",
            "What is whole language approach?",
            "How to help children with math?",
            "Tips for science experiments at home.",
            "How to introduce art to children?",
            "What is music education for kids?",
            "How to teach children about nature?",
            "Explain environmental education for kids.",
            "What are the benefits of storytelling for children?",
            "How to encourage imagination in children?",
            "Tips for screen time limits for kids.",
            "What are healthy eating habits for children?",
            "How to deal with picky eaters?",
            "Explain food allergies in children.",
            "How to encourage physical activity in children?",
            "What are developmental milestones?",
            "Tips for potty training.",
            "How to handle temper tantrums?",
            "What is positive discipline?",
            "Explain logical consequences.",
            "How to teach empathy to children?",
            "Tips for teaching generosity.",
            "How to foster gratitude in children?",
            "What is emotional regulation for kids?",
            "How to help children cope with big emotions?",
            "Explain resilience in children.",
            "What are coping mechanisms for kids?",
            "How to build a child's confidence?",
            "Tips for managing sibling relationships.",
            "How to prepare for a new baby?",
            "What is postpartum depression?",
            "How to support a partner after childbirth?",
            "Tips for new parents.",
            "What are common newborn challenges?",
            "How to breastfeed successfully?",
            "Explain bottle feeding.",
            "What is safe sleep for infants?",
            "How to manage infant crying?",
            "Tips for baby soothing techniques.",
            "What is colic?",
            "How to introduce solid foods to babies?",
            "Explain baby-led weaning.",
            "What are common baby illnesses?",
            "How to take a baby's temperature?",
            "Tips for infant first aid.",
            "What is toddler development?",
            "How to handle toddler tantrums?",
            "Explain the 'terrible twos'.",
            "How to encourage speech development in toddlers?",
            "Tips for toilet training toddlers.",
            "What are good toddler activities?",
            "How to promote social skills in toddlers?",
            "Explain parallel play.",
            "What is imaginative play?",
            "How to manage bedtime routines for toddlers?",
            "Tips for dealing with toddler sleep regressions.",
            "What are common toddler fears?",
            "How to ease separation anxiety in toddlers?",
            "Explain positive parenting.",
            "What is gentle parenting?",
            "How to set boundaries with toddlers?",
            "Tips for dealing with toddler biting or hitting.",
            "What is preschool development?",
            "How to prepare a child for preschool?",
            "Explain social skills for preschoolers.",
            "What are good preschool activities?",
            "How to teach preschoolers letters and numbers?",
            "Tips for improving fine motor skills in preschoolers.",
            "What are gross motor skills?",
            "How to encourage independent play in preschoolers?",
            "Explain cooperative play.",
            "What is dramatic play?",
            "How to foster problem-solving skills in preschoolers?",
            "Tips for managing preschooler behavior challenges.",
            "What is kindergarten readiness?",
            "How to support children's transition to school?",
            "Explain school-age development.",
            "What are academic skills for school-age children?",
            "How to help with homework?",
            "Tips for building good study habits.",
            "What are common learning challenges in school-age children?",
            "How to support children with ADHD?",
            "Explain dyslexia.",
            "What are autism spectrum disorders?",
            "How to encourage reading in school-age children?",
            "Tips for developing writing skills.",
            "How to make math fun?",
            "What are benefits of extracurricular activities for school-age children?",
            "How to deal with bullying?",
            "Explain peer pressure.",
            "What is healthy self-esteem in school-age children?",
            "How to teach responsibility to school-age children?",
            "Tips for managing screen time for school-age children?",
            "What is adolescent development?",
            "How to communicate with teenagers?",
            "Explain puberty.",
            "What are common teenage challenges?",
            "How to support teenagers' mental health?",
            "Tips for discussing difficult topics with teenagers.",
            "What is identity formation in adolescence?",
            "How to navigate peer relationships in adolescence?",
            "Explain romantic relationships in adolescence.",
            "What are common teenage stressors?",
            "How to build resilience in teenagers?",
            "Tips for college application process.",
            "What is career exploration for teenagers?",
            "How to teach financial literacy to teenagers?",
            "Explain civic engagement for teenagers.",
            "What are global issues teenagers should know?",
            "How to encourage critical thinking in teenagers?",
            "Tips for managing stress as a teenager.",
            "What are healthy coping mechanisms for teenagers?",
            "How to promote self-advocacy in teenagers?",
            "Explain the concept of consent to teenagers.",
            "What is responsible social media use for teenagers?",
            "How to address cyberbullying?",
            "Tips for safe online interactions for teenagers.",
            "What are warning signs of substance abuse in teenagers?",
            "How to talk to teenagers about sex education?",
            "Explain reproductive health for teenagers.",
            "What are sexually transmitted infections (STIs)?",
            "How to teach healthy relationships to teenagers?",
            "Tips for managing emotions in adolescence.",
            "What is emotional regulation in teenagers?",
            "How to help teenagers develop empathy?",
            "Explain moral development in adolescence.",
            "What is character education for teenagers?",
            "How to encourage volunteering in teenagers?",
            "Tips for building leadership skills in teenagers.",
            "What is entrepreneurship for teenagers?",
            "How to foster innovation in teenagers?",
            "Explain design thinking for teenagers.",
            "What are future job skills?",
            "How to prepare teenagers for the future of work?",
            "Tips for developing a growth mindset in teenagers.",
            "What is neuroplasticity?",
            "How to improve memory?",
            "Explain cognitive biases.",
            "What is decision-making theory?",
            "How to improve problem-solving skills?",
            "Tips for creative thinking techniques.",
            "What is lateral thinking?",
            "How to brainstorm effectively?",
            "Explain mind mapping.",
            "What are logical fallacies?",
            "How to analyze arguments?",
            "Tips for persuasive writing.",
            "What is rhetoric?",
            "How to give a compelling presentation?",
            "Explain nonverbal communication.",
            "What is body language?",
            "How to read facial expressions?",
            "Tips for improving listening skills.",
            "What is active listening?",
            "How to build rapport?",
            "Explain emotional intelligence in leadership.",
            "What is servant leadership?",
            "How to motivate a team?",
            "Tips for conflict resolution in the workplace.",
            "What is negotiation strategy?",
            "How to conduct effective meetings?",
            "Explain project management methodologies.",
            "What is Agile development?",
            "How to manage risk in projects?",
            "Tips for effective delegation.",
            "What is time blocking?",
            "How to use productivity tools?",
            "Explain the 'Getting Things Done' (GTD) method.",
            "What is the 80/20 rule?",
            "How to overcome perfectionism?",
            "Tips for dealing with stress at work.",
            "What is work-life balance?",
            "How to prevent burnout?",
            "Explain mindfulness at work.",
            "What is imposter syndrome in the workplace?",
            "How to build a professional network?",
            "Tips for career advancement.",
            "What is personal branding?",
            "How to write a professional email?",
            "Explain business ethics.",
            "What is corporate social responsibility?",
            "How to build a diverse and inclusive workplace?",
            "Tips for managing remote teams.",
            "What is cybersecurity best practices?",
            "How to protect personal data online?",
            "Explain phishing scams.",
            "What is ransomware?",
            "How to create strong passwords?",
            "Tips for secure browsing.",
            "What is two-factor authentication?",
            "How to use a VPN?",
            "Explain data encryption.",
            "What is cloud security?",
            "How to backup data effectively?",
            "Tips for managing digital privacy.",
            "What is GDPR?",
            "Explain CCPA.",
            "How to identify fake news?",
            "Tips for media literacy.",
            "What is critical thinking about news?",
            "How to verify information online?",
            "Explain logical fallacies in arguments.",
            "What is cognitive bias in decision making?",
            "How to overcome confirmation bias?",
            "Tips for effective communication in a crisis.",
            "What is crisis management?",
            "How to prepare for natural disasters?",
            "Explain first aid basics.",
            "What to do in a fire emergency?",
            "How to perform CPR?",
            "Tips for staying safe online.",
            "What is online etiquette?",
            "How to be a good digital citizen?",
            "Explain responsible AI development.",
            "What are the ethical implications of AI?",
            "How to ensure AI fairness?",
            "Tips for developing trustworthy AI.",
            "What is human-centered AI design?",
            "Explain AI explainability (XAI).",
            "What is value alignment in AI?",
            "How to regulate AI?",
            "Tips for AI policy making.",
            "What is AI governance?",
            "How to promote responsible innovation?",
            "Explain technological singularity.",
            "What is transhumanism?",
            "How to live a minimalist lifestyle?",
            "Tips for decluttering your home.",
            "What are the benefits of minimalism?",
            "How to reduce waste?",
            "Explain composting.",
            "What is upcycling?",
            "How to save energy at home?",
            "Tips for sustainable fashion.",
            "What is ethical consumption?",
            "How to support local businesses?",
            "Explain fair trade.",
            "What is conscious consumerism?",
            "How to reduce plastic use?",
            "Tips for growing your own food.",
            "What are organic farming practices?",
            "Explain permaculture.",
            "What is vertical farming?",
            "How to conserve water in gardening?",
            "Tips for attracting pollinators to your garden.",
            "What are native plants?",
            "How to create a rain garden?",
            "Explain ecological footprint.",
            "What is carbon neutrality?",
            "How to offset carbon emissions?",
            "Tips for renewable energy adoption.",
            "What is solar power?",
            "Explain wind energy.",
            "What are geothermal energy benefits?",
            "How to promote sustainable transportation?",
            "Tips for electric vehicle adoption.",
            "What is public transportation?",
            "How to encourage walking and cycling?",
            "Explain urban planning for sustainability.",
            "What is green building?",
            "How to design energy-efficient homes?",
            "Tips for sustainable waste management.",
            "What is zero-waste living?",
            "How to reduce food waste?",
            "Explain circular economy.",
            "What are challenges of sustainable development?",
            "How to achieve the UN Sustainable Development Goals?",
            "Tips for environmental activism.",
            "What is citizen science?",
            "How to get involved in conservation?",
            "Explain biodiversity loss.",
            "What are endangered species?",
            "How to protect wildlife?",
            "Tips for marine conservation.",
            "What is plastic pollution?",
            "How to clean up oceans?",
            "Explain reforestation efforts.",
            "What are benefits of planting trees?",
            "How to restore wetlands?",
            "Tips for protecting freshwater resources.",
            "What is water scarcity?",
            "How to manage water resources sustainably?",
            "Explain desertification.",
            "What are impacts of deforestation?",
            "How to prevent soil erosion?",
            "Tips for sustainable agriculture.",
            "What is agroforestry?",
            "How to promote regenerative farming?",
            "Explain food security.",
            "What are global hunger issues?",
            "How to ensure equitable food access?",
            "Tips for reducing global poverty.",
            "What is microfinance?",
            "How to support economic development?",
            "Explain social justice.",
            "What are human rights abuses?",
            "How to promote peace and conflict resolution?",
            "Tips for humanitarian aid.",
            "What is disaster relief?",
            "How to support refugees?",
            "Explain global health challenges.",
            "What are pandemics?",
            "How to improve public health?",
            "Tips for disease prevention.",
            "What is universal healthcare?",
            "How to address health disparities?",
            "Explain mental health awareness.",
            "What are common mental health conditions?",
            "How to seek mental health support?",
            "Tips for reducing mental health stigma.",
            "What is cognitive behavioral therapy (CBT)?",
            "Explain dialectical behavior therapy (DBT).",
            "What is psychotherapy?",
            "How to find a good therapist?",
            "Tips for managing anxiety.",
            "What are symptoms of depression?",
            "How to cope with grief?",
            "Explain trauma-informed care.",
            "What is PTSD?",
            "How to support someone with a mental illness?",
            "Tips for self-compassion.",
            "What is positive self-talk?",
            "How to build emotional resilience?",
            "Explain the power of forgiveness.",
            "What is gratitude journaling?",
            "How to practice daily affirmations?",
            "Tips for building a meditation habit.",
            "What are different types of meditation?",
            "How to start a yoga practice?",
            "Explain the benefits of stretching.",
            "What is strength training?",
            "How to improve cardiovascular health?",
            "Tips for a healthy diet.",
            "What are macronutrients?",
            "Explain micronutrients.",
            "What is intermittent fasting?",
            "How to meal prep effectively?",
            "Tips for weight management.",
            "What are signs of healthy eating?",
            "How to overcome emotional eating?",
            "Explain intuitive eating.",
            "What are common food myths?",
            "How to read nutrition labels?",
            "Tips for cooking healthy meals.",
            "What is food safety?",
            "How to prevent foodborne illnesses?",
            "Explain organic vs. conventional food.",
            "What are genetically modified organisms (GMOs)?",
            "How to reduce sugar intake?",
            "Tips for reducing processed foods.",
            "What are healthy snack ideas?",
            "How to stay motivated to exercise?",
            "Explain the benefits of walking.",
            "What is high-intensity interval training (HIIT)?",
            "How to build muscle?",
            "Tips for improving flexibility.",
            "What is functional fitness?",
            "How to prevent sports injuries?",
            "Explain warm-up and cool-down exercises.",
            "What is foam rolling?",
            "How to relieve muscle soreness?",
            "Tips for managing chronic pain.",
            "What are benefits of massage therapy?",
            "Explain acupuncture.",
            "What is chiropractic care?",
            "How to improve sleep hygiene?",
            "Tips for overcoming insomnia.",
            "What are different sleep stages?",
            "How to deal with jet lag?",
            "Explain sleep apnea.",
            "What are benefits of napping?",
            "How to manage shift work sleep disorder?",
            "Tips for creating a relaxing bedtime routine.",
            "What are natural sleep aids?",
            "How to reduce screen time before bed?",
            "Explain the impact of caffeine on sleep.",
            "What are benefits of sunlight exposure?",
            "How to boost vitamin D levels?",
            "Tips for eye health.",
            "What are signs of digital eye strain?",
            "How to protect hearing?",
            "Explain tinnitus.",
            "What are common skin conditions?",
            "How to maintain healthy skin?",
            "Tips for sun protection.",
            "What are signs of skin cancer?",
            "How to manage acne?",
            "Explain eczema.",
            "What is psoriasis?",
            "How to care for hair?",
            "Tips for nail health.",
            "What are signs of dehydration?",
            "How to stay hydrated effectively?",
            "Explain electrolytes.",
            "What are benefits of drinking water?",
            "How to track water intake?",
            "Tips for incorporating more fruits and vegetables.",
            "What are benefits of fiber?",
            "Explain probiotics.",
            "What are prebiotics?",
            "How to improve gut health?",
            "Tips for managing digestive issues.",
            "What is IBS?",
            "Explain Crohn's disease.",
            "What is ulcerative colitis?",
            "How to manage acid reflux?",
            "Tips for a healthy colon.",
            "What are benefits of meditation for digestion?",
            "How to reduce inflammation through diet?",
            "Explain autoimmune diseases.",
            "What is chronic fatigue syndrome?",
            "How to manage fibromyalgia?",
            "Tips for living with diabetes.",
            "What are symptoms of high blood sugar?",
            "How to manage blood pressure?",
            "Explain cholesterol levels.",
            "What are signs of heart attack?",
            "How to prevent stroke?",
            "Tips for bone health.",
            "What is osteoporosis?",
            "How to maintain joint health?",
            "Explain arthritis.",
            "What are benefits of Omega-3 fatty acids?",
            "How to boost brain health?",
            "Tips for preventing cognitive decline.",
            "What are signs of dementia?",
            "How to support brain aging?",
            "Explain neurodegenerative diseases.",
            "What is Parkinson's disease?",
            "How to manage Alzheimer's disease?",
            "Tips for improving memory and focus.",
            "What are brain training exercises?",
            "How to learn new skills to boost brain health?",
            "Explain the benefits of reading for the brain.",
            "What is neurodiversity?",
            "How to support neurodivergent individuals?",
            "Tips for understanding autism spectrum.",
            "What is ADHD management?",
            "How to help someone with dyslexia?",
            "Explain the concept of neurotypical.",
            "What are sensory processing issues?",
            "How to create sensory-friendly environments?",
            "Tips for effective communication with neurodivergent people.",
            "What is social communication disorder?",
            "How to foster inclusivity for all abilities?",
            "Explain universal design.",
            "What are assistive technologies?",
            "How to advocate for disability rights?",
            "Tips for being an ally to marginalized groups.",
            "What is intersectionality?",
            "How to understand privilege?",
            "Explain systemic racism.",
            "What is unconscious bias?",
            "How to challenge discrimination?",
            "Tips for promoting equality.",
            "What is diversity and inclusion (D&I)?",
            "How to build an equitable society?",
            "Explain the role of education in social change.",
            "What are civil rights movements?",
            "How to engage in peaceful protests?",
            "Tips for community organizing.",
            "What is grassroots activism?",
            "How to create social impact?",
            "Explain philanthropy.",
            "What are non-profit organizations?",
            "How to volunteer effectively?",
            "Tips for ethical consumerism.",
            "What is impact investing?",
            "How to support fair trade initiatives?",
            "Explain corporate social responsibility.",
            "What are sustainable business practices?",
            "How to measure social impact?",
            "Tips for ethical leadership.",
            "What is servant leadership?",
            "How to build a purpose-driven organization?",
            "Explain stakeholder capitalism.",
            "What are B Corps?",
            "How to balance profit and purpose?",
            "Tips for social entrepreneurship.",
            "What is disruptive innovation?",
            "How to foster creativity in business?",
            "Explain design thinking for problem-solving.",
            "What are lean startup principles?",
            "How to conduct market research?",
            "Tips for developing a business plan.",
            "What is intellectual property?",
            "How to protect your brand?",
            "Explain trademark and copyright.",
            "What are patents?",
            "How to raise capital for a startup?",
            "Tips for pitching to investors.",
            "What is venture capital?",
            "Explain angel investors.",
            "What are crowdfunding platforms?",
            "How to manage business finances?",
            "Tips for financial forecasting.",
            "What is break-even analysis?",
            "How to optimize cash flow?",
            "Explain profit and loss statements.",
            "What is a balance sheet?",
            "How to interpret financial ratios?",
            "Tips for effective budgeting.",
            "What is risk management in business?",
            "How to create a crisis management plan?",
            "Explain business continuity planning.",
            "What are cybersecurity risks for businesses?",
            "How to protect business data?",
            "Tips for data privacy compliance.",
            "What is GDPR for businesses?",
            "How to build a strong company culture?",
            "Explain employee engagement.",
            "What are performance management strategies?",
            "How to provide constructive feedback to employees?",
            "Tips for conflict resolution in teams.",
            "What is diversity and inclusion in HR?",
            "How to recruit top talent?",
            "Explain onboarding processes.",
            "What are employee benefits?",
            "How to manage employee compensation?",
            "Tips for leadership development.",
            "What is succession planning?",
            "How to foster innovation in the workplace?",
            "Explain change management.",
            "What is organizational development?",
            "How to build a learning organization?",
            "Tips for continuous improvement.",
            "What is Six Sigma?",
            "Explain Lean methodology.",
            "What is Total Quality Management (TQM)?",
            "How to conduct a SWOT analysis?",
            "Tips for strategic planning.",
            "What is competitive analysis?",
            "How to identify market trends?",
            "Explain customer relationship management (CRM).",
            "What are sales strategies?",
            "How to develop a marketing plan?",
            "Tips for digital marketing.",
            "What is content marketing?",
            "Explain SEO best practices.",
            "What is social media marketing?",
            "How to run effective ad campaigns?",
            "Tips for email marketing.",
            "What is influencer marketing?",
            "How to measure marketing ROI?",
            "Explain brand building.",
            "What is brand identity?",
            "How to create a strong brand message?",
            "Tips for public relations.",
            "What is crisis communication?",
            "How to manage a brand's reputation?",
            "Explain customer service excellence.",
            "What are key performance indicators (KPIs)?",
            "How to use data analytics in business?",
            "Tips for business intelligence.",
            "What is big data?",
            "Explain cloud computing for business.",
            "What are enterprise resource planning (ERP) systems?",
            "How to use AI in business operations?",
            "Tips for automation in business.",
            "What is robotic process automation (RPA)?",
            "How to implement machine learning in business?",
            "Explain the Internet of Things (IoT) in industry.",
            "What is Industry 4.0?",
            "How to leverage augmented reality in business?",
            "Tips for virtual reality applications in enterprise.",
            "What is quantum computing?",
            "Explain the future of work.",
            "What are trends in remote work?",
            "How to design hybrid work models?",
            "Tips for fostering collaboration in distributed teams.",
            "What is employee well-being in the workplace?",
            "How to support mental health at work?",
            "Explain stress management for employees.",
            "What is resilience in the workplace?",
            "How to promote a positive work environment?",
            "Tips for building psychological safety at work.",
            "What is inclusive leadership?",
            "How to address unconscious bias in hiring?",
            "Explain diversity recruitment strategies.",
            "What is equity in the workplace?",
            "How to create belonging at work?",
            "Tips for culturally competent leadership.",
            "What is global citizenship?",
            "How to understand different cultures?",
            "Explain cross-cultural communication.",
            "What are global etiquette rules?",
            "How to manage international teams?",
            "Tips for working abroad.",
            "What is expat life?",
            "How to adjust to a new country?",
            "Explain cultural shock.",
            "What are common travel scams?",
            "How to stay safe while traveling?",
            "Tips for responsible tourism.",
            "What is ecotourism?",
            "How to minimize environmental impact while traveling?",
            "Explain sustainable tourism practices.",
            "What are voluntourism opportunities?",
            "How to choose an ethical volunteer program?",
            "Tips for learning about local traditions.",
            "What are intangible cultural heritage?",
            "How to protect historical sites?",
            "Explain heritage tourism.",
            "What is pilgrimage tourism?",
            "How to respect sacred places?",
            "Tips for adventure travel.",
            "What are extreme sports?",
            "How to prepare for a hiking trip?",
            "Explain backpacking essentials.",
            "What is glamping?",
            "How to choose camping gear?",
            "Tips for wildlife viewing.",
            "What are safari ethics?",
            "How to photograph nature responsibly?",
            "Explain astrophotography.",
            "What is urban exploration?",
            "How to practice street photography?",
            "Tips for portrait photography.",
            "What are landscape photography techniques?",
            "How to use natural light in photography?",
            "Explain composition rules in photography.",
            "What is post-processing in photography?",
            "How to edit photos in Lightroom?",
            "Tips for using Photoshop.",
            "What are video editing software options?",
            "How to create a short film?",
            "Explain documentary filmmaking.",
            "What is animation?",
            "How to draw cartoons?",
            "Tips for digital art creation.",
            "What are graphic design principles?",
            "How to create a logo?",
            "Explain typography basics.",
            "What are color theory principles?",
            "How to design a website?",
            "Tips for UX/UI design.",
            "What is user research?",
            "How to conduct usability testing?",
            "Explain wireframing and prototyping.",
            "What are front-end development technologies?",
            "How to learn React.js?",
            "Tips for back-end development.",
            "What is Python for data science?",
            "How to use R for statistical analysis?",
            "Explain machine learning algorithms.",
            "What is deep learning?",
            "How to build a neural network?",
            "Tips for natural language processing (NLP).",
            "What is computer vision?",
            "How to apply AI in healthcare?",
            "Explain AI in finance.",
            "What are applications of AI in education?",
            "How to use AI in marketing?",
            "Tips for AI-powered customer service.",
            "What is AI ethics?",
            "How to ensure AI transparency?",
            "Explain AI bias.",
            "What are ethical guidelines for AI?",
            "How to develop responsible AI systems?",
            "Tips for AI governance frameworks.",
            "What is the future of AI?",
            "How will AI change society?",
            "Explain the concept of superintelligence.",
            "What are risks of advanced AI?",
            "How to prepare for an AI-driven future?",
            "Tips for human-AI collaboration.",
            "What is the singularity?",
            "How to balance technological progress with human values?",
            "Explain the role of philosophy in AI.",
            "What is consciousness?",
            "How does the brain work?",
            "Tips for understanding neuroscience.",
            "What are mental models?",
            "How to improve cognitive function?",
            "Explain neurofeedback.",
            "What are brainwave states?",
            "How to enhance creativity through brain training?",
            "Tips for improving memory recall.",
            "What is mnemonics?",
            "How to learn faster?",
            "Explain spaced repetition.",
            "What are active recall techniques?",
            "Tips for note-taking strategies.",
            "What is Cornell Notes system?",
            "How to use mind maps for learning?",
            "Explain Feynman technique.",
            "What are different learning theories?",
            "How to apply constructivism in education?",
            "Tips for project-based learning.",
            "What is inquiry-based science?",
            "How to teach coding to kids?",
            "Explain robotics for education.",
            "What are benefits of AI in education?",
            "How to use virtual reality for learning?",
            "Tips for augmented reality in classrooms.",
            "What is gamified learning?",
            "How to design educational games?",
            "Explain serious games for training.",
            "What are simulations in education?",
            "How to use digital storytelling in the classroom?",
            "Tips for creating educational videos.",
            "What are podcasts for learning?",
            "How to use social media for educational purposes responsibly?",
            "Explain online collaboration tools for students.",
            "What are virtual field trips?",
            "How to leverage open educational resources (OER)?",
            "Tips for copyright and fair use in education.",
            "What is academic integrity?",
            "How to prevent plagiarism among students?",
            "Explain ethical research practices.",
            "What are student data privacy concerns?",
            "How to protect student information?",
            "Tips for responsible use of AI by students.",
            "What is AI literacy?",
            "How to teach students about AI?",
            "Explain the societal impact of AI for young learners.",
            "What are career opportunities in AI?",
            "How to prepare students for an AI-driven workforce?",
            "Tips for developing future-ready skills.",
            "What is emotional intelligence for students?",
            "How to teach empathy and compassion?",
            "Explain conflict resolution skills for children.",
            "What are positive communication techniques for students?",
            "How to build resilience in young learners?",
            "Tips for fostering a growth mindset in the classroom.",
            "What is self-regulation for students?",
            "How to manage stress in school?",
            "Explain mindfulness practices for students.",
            "What are positive psychology principles in education?",
            "How to promote happiness and well-being in schools?",
            "Tips for character education.",
            "What are values education approaches?",
            "How to teach ethics to children?",
            "Explain civic responsibility for students.",
            "What is global awareness in education?",
            "How to foster intercultural understanding?",
            "Tips for promoting human rights education.",
            "What are peace education strategies?",
            "How to teach about sustainable development goals?",
            "Explain environmental stewardship for kids.",
            "What is climate literacy?",
            "How to engage students in environmental action?",
            "Tips for community service learning projects.",
            "What are benefits of volunteering for students?",
            "How to promote leadership skills in school?",
            "Explain entrepreneurship education for youth.",
            "What are financial literacy programs for students?",
            "How to teach personal finance skills?",
            "Tips for career counseling for teenagers.",
            "What are vocational education pathways?",
            "How to prepare for higher education?",
            "Explain college application essays.",
            "What are scholarship opportunities?",
            "How to choose the right college major?",
            "Tips for career planning.",
            "What is lifelong learning?",
            "How to continuously develop new skills?",
            "Explain reskilling and upskilling.",
            "What are future skills for the workplace?",
            "How to adapt to changing job markets?",
            "Tips for career transitions.",
            "What is personal development?",
            "How to set personal goals?",
            "Explain habits and routines for success.",
            "What are productivity hacks?",
            "How to manage time effectively?",
            "Tips for overcoming procrastination.",
            "What is self-discipline?",
            "How to build motivation?",
            "Explain the power of positive thinking.",
            "What are visualization techniques?",
            "How to use affirmations for personal growth?",
            "Tips for gratitude practice.",
            "What is mindfulness in daily life?",
            "How to reduce stress and anxiety?",
            "Explain relaxation techniques.",
            "What are breathing exercises?",
            "How to practice meditation for beginners?",
            "Tips for improving sleep quality.",
            "What are healthy eating habits?",
            "How to maintain a balanced diet?",
            "Explain the benefits of regular exercise.",
            "What is a holistic approach to health?",
            "How to boost your immune system?",
            "Tips for managing chronic conditions.",
            "What is preventive healthcare?",
            "How to find a good doctor?",
            "Explain patient advocacy.",
            "What are health insurance options?",
            "How to understand medical billing?",
            "Tips for navigating the healthcare system.",
            "What is mental well-being?",
            "How to identify signs of mental health issues?",
            "Explain therapy options.",
            "What are support groups?",
            "How to help someone with depression?",
            "Tips for suicide prevention.",
            "What is substance abuse awareness?",
            "How to seek help for addiction?",
            "Explain recovery process.",
            "What are signs of an unhealthy relationship?",
            "How to set healthy boundaries?",
            "Tips for effective communication in relationships.",
            "What is conflict resolution in personal relationships?",
            "How to build trust in relationships?",
            "Explain healthy dating practices.",
            "What are signs of domestic violence?",
            "How to seek help for abuse?",
            "Tips for building self-esteem.",
            "What is self-love?",
            "How to practice self-compassion?",
            "Explain body positivity.",
            "What is imposter syndrome?",
            "How to overcome self-doubt?",
            "Tips for building confidence.",
            "What is resilience in adults?",
            "How to cope with stress and adversity?",
            "Explain post-traumatic growth.",
            "What are different types of intelligence?",
            "How to improve emotional intelligence?",
            "Tips for developing social skills.",
            "What is empathy vs. sympathy?",
            "How to be a better listener?",
            "Explain assertive communication.",
            "What is non-violent communication?",
            "How to give and receive feedback effectively?",
            "Tips for public speaking anxiety.",
            "What is charisma?",
            "How to build rapport quickly?",
            "Explain negotiation skills.",
            "What are conflict management styles?",
            "How to mediate a dispute?",
            "Tips for teamwork and collaboration.",
            "What is effective leadership?",
            "How to motivate others?",
            "Explain delegation strategies.",
            "What is coaching and mentoring?",
            "How to inspire creativity in a team?",
            "Tips for managing diverse teams.",
            "What is cross-cultural competence?",
            "How to resolve cultural misunderstandings?",
            "Explain global awareness for professionals.",
            "What are international business etiquette rules?",
            "How to adapt to new work environments?",
            "Tips for career planning and development.",
            "What is a personal mission statement?",
            "How to identify your strengths and weaknesses?",
            "Explain career mapping.",
            "What are job search strategies?",
            "How to write a compelling resume?",
            "Tips for successful job interviews.",
            "What is networking for career advancement?",
            "How to use LinkedIn effectively?",
            "Explain personal branding for professionals.",
            "What is salary negotiation?",
            "How to manage career transitions?",
            "Tips for entrepreneurship for beginners.",
            "What is a business model canvas?",
            "How to validate a business idea?",
            "Explain lean startup methodology.",
            "What are minimum viable products (MVPs)?",
            "How to secure startup funding?",
            "Tips for pitching to investors.",
            "What is venture capital funding?",
            "How to build a startup team?",
            "Explain intellectual property protection.",
            "What are legal considerations for startups?",
            "How to create a marketing strategy for a small business?",
            "Tips for social media marketing for businesses.",
            "What is content marketing for startups?",
            "How to measure marketing campaign effectiveness?",
            "Explain customer acquisition strategies.",
            "What is customer retention?",
            "How to provide excellent customer service?",
            "Tips for building customer loyalty.",
            "What is public relations for businesses?",
            "How to manage negative publicity?",
            "Explain crisis communication for companies.",
            "What are ethical business practices?",
            "How to implement corporate social responsibility?",
            "Tips for sustainable business models.",
            "What is green business?",
            "How to reduce environmental impact in business?",
            "Explain circular economy principles for companies.",
            "What are certifications for sustainable businesses?",
            "How to measure environmental performance?",
            "Tips for supply chain sustainability.",
            "What is ethical sourcing?",
            "How to ensure fair labor practices?",
            "Explain responsible consumption and production.",
            "What are UN Sustainable Development Goals for business?",
            "How to report on sustainability efforts?",
            "Tips for engaging employees in sustainability.",
            "What is corporate governance?",
            "How to ensure board diversity?",
            "Explain shareholder activism.",
            "What are regulations for publicly traded companies?",
            "How to manage mergers and acquisitions?",
            "Tips for business expansion strategies.",
            "What is international trade?",
            "How to export goods and services?",
            "Explain import regulations.",
            "What are global supply chain challenges?",
            "How to mitigate geopolitical risks for businesses?",
            "Tips for navigating international markets.",
            "What is foreign exchange risk?",
            "How to manage currency fluctuations?",
            "Explain international financial reporting standards.",
            "What are global tax considerations?",
            "How to comply with international business laws?",
            "Tips for cross-border investments.",
            "What is the World Trade Organization (WTO)?",
            "How do trade agreements work?",
            "Explain economic sanctions.",
            "What are trade wars?",
            "How to assess country risk?",
            "Tips for political risk analysis.",
            "What is the role of diplomacy in international business?",
            "How to negotiate with international partners?",
            "Explain cultural intelligence for business leaders.",
            "What are communication styles across cultures?",
            "How to build trust in global teams?",
            "Tips for managing cultural differences in the workplace.",
            "What is virtual team management?",
            "How to foster collaboration in remote global teams?",
            "Explain digital nomad lifestyle.",
            "What are remote work trends?",
            "How to build a successful distributed company?",
            "Tips for managing time zones effectively.",
            "What is the future of work post-pandemic?",
            "How will automation affect jobs?",
            "Explain the gig economy's impact on employment.",
            "What are new job roles in emerging technologies?",
            "How to prepare for job displacement?",
            "Tips for reskilling and upskilling for automation.",
            "What is continuous learning in the workplace?",
            "How to develop adaptability in your career?",
            "Explain the importance of soft skills.",
            "What are critical thinking skills for the future?",
            "How to improve problem-solving abilities?",
            "Tips for fostering creativity in your career.",
            "What is emotional intelligence in the professional world?",
            "How to build strong professional networks?",
            "Explain mentorship and sponsorship in career growth.",
            "What are leadership development programs?",
            "How to become an effective leader?",
            "Tips for strategic thinking in leadership.",
            "What is change leadership?",
            "How to navigate organizational change?",
            "Explain innovation management.",
            "What are trends in organizational culture?",
            "How to build a positive and inclusive workplace culture?",
            "Tips for employee well-being initiatives.",
            "What is mental health support in the workplace?",
            "How to prevent burnout in high-stress jobs?",
            "Explain work-life integration.",
            "What are flexible work arrangements?",
            "How to manage stress and anxiety at work?",
            "Tips for promoting psychological safety.",
            "What is diversity, equity, and inclusion (DEI) in organizations?",
            "How to implement DEI strategies effectively?",
            "Explain unconscious bias training.",
            "What are microaggressions in the workplace?",
            "How to create a sense of belonging for all employees?",
            "Tips for allyship in the workplace.",
            "What is inclusive hiring?",
            "How to reduce bias in recruitment?",
            "Explain fair compensation practices.",
            "What are performance reviews best practices?",
            "How to give constructive feedback effectively?",
            "Tips for managing difficult conversations at work.",
            "What is conflict resolution in teams?",
            "How to build high-performing teams?",
            "Explain team dynamics.",
            "What are leadership styles?",
            "How to choose the right leadership approach?",
            "Tips for motivating diverse teams.",
            "What is servant leadership in practice?",
            "How to empower employees?",
            "Explain delegation techniques.",
            "What are effective meeting strategies?",
            "How to run productive brainstorming sessions?",
            "Tips for decision-making in teams.",
            "What is agile project management?",
            "How to implement Scrum methodology?",
            "Explain Kanban boards.",
            "What are project management software tools?",
            "How to manage project risks?",
            "Tips for stakeholder management.",
            "What is resource allocation in projects?",
            "How to track project progress?",
            "Explain project closure best practices.",
            "What is quality management in projects?",
            "How to conduct post-mortems for projects?",
            "Tips for continuous improvement in operations.",
            "What is Lean Six Sigma?",
            "How to optimize business processes?",
            "Explain supply chain management strategies.",
            "What are logistics and transportation trends?",
            "How to manage inventory effectively?",
            "Tips for warehouse optimization.",
            "What is e-commerce fulfillment?",
            "How to handle returns and reverse logistics?",
            "Explain retail operations management.",
            "What are customer experience (CX) strategies?",
            "How to map the customer journey?",
            "Tips for enhancing customer satisfaction.",
            "What is net promoter score (NPS)?",
            "How to collect customer feedback?",
            "Explain customer service best practices.",
            "What are chatbots for customer support?",
            "How to use AI in customer service?",
            "Tips for personalizing customer interactions.",
            "What is customer relationship management (CRM) software?",
            "How to implement a CRM system?",
            "Explain sales process optimization.",
            "What are B2B sales strategies?",
            "How to cold call effectively?",
            "Tips for lead generation.",
            "What is conversion rate optimization?",
            "How to build a sales funnel?",
            "Explain marketing automation.",
            "What are email marketing best practices?",
            "How to design effective landing pages?",
            "Tips for search engine marketing (SEM).",
            "What is Google Ads?",
            "How to optimize for local SEO?",
            "Explain content strategy for websites.",
            "What are types of blog content?",
            "How to write engaging headlines?",
            "Tips for social media content creation.",
            "What is video marketing?",
            "How to use TikTok for business?",
            "Explain Instagram marketing strategies.",
            "What are LinkedIn marketing best practices?",
            "How to build a brand community online?",
            "Tips for online reputation management.",
            "What is public relations for startups?",
            "How to write a press release?",
            "Explain media relations.",
            "What are crisis communication plans?",
            "How to manage negative online reviews?",
            "Tips for building brand loyalty.",
            "What is experiential marketing?",
            "How to create memorable brand experiences?",
            "Explain cause marketing.",
            "What are corporate partnerships?",
            "How to measure marketing campaign ROI?",
            "Tips for analytics and reporting in marketing.",
            "What is A/B testing?",
            "How to use Google Analytics?",
            "Explain data visualization for marketing insights.",
            "What are market research methods?",
            "How to conduct surveys effectively?",
            "Tips for competitor analysis.",
            "What is market segmentation?",
            "How to identify target audiences?",
            "Explain product development process.",
            "What are stages of the product lifecycle?",
            "How to launch a new product successfully?",
            "Tips for product pricing strategies.",
            "What is product management?",
            "How to work with engineering teams?",
            "Explain user stories and product backlogs.",
            "What are agile product development principles?",
            "How to conduct user acceptance testing (UAT)?",
            "Tips for managing product roadmaps.",
            "What is product market fit?",
            "How to scale a product?",
            "Explain product growth strategies.",
            "What are strategies for product iteration?",
            "How to sunset a product?",
            "Tips for building minimum viable products (MVPs).",
            "What is design thinking in product development?",
            "How to conduct user interviews?",
            "Explain prototyping tools.",
            "What are usability heuristics?",
            "How to perform heuristic evaluation?",
            "Tips for accessibility in design.",
            "What is inclusive design?",
            "How to design for diverse users?",
            "Explain ethical design principles.",
            "What are dark patterns in UX?",
            "How to design for privacy?",
            "Tips for creating user-centered designs.",
            "What is information architecture?",
            "How to organize content for usability?",
            "Explain navigation design.",
            "What are interaction design principles?",
            "How to design intuitive interfaces?",
            "Tips for creating delightful user experiences.",
            "What is animation in UI design?",
            "How to use microinteractions effectively?",
            "Explain haptic feedback in UI.",
            "What are responsive web design principles?",
            "How to design for mobile first?",
            "Tips for cross-browser compatibility.",
            "What is progressive web app (PWA) development?",
            "How to optimize website performance?",
            "Explain critical rendering path.",
            "What are web accessibility standards?",
            "How to make websites accessible for all users?",
            "Tips for search engine optimization (SEO) for designers.",
            "What is Google's Core Web Vitals?",
            "How to improve website SEO?",
            "Explain schema markup.",
            "What are backlinks and link building?",
            "How to conduct keyword research?",
            "Tips for on-page SEO optimization.",
            "What is technical SEO?",
            "How to audit website SEO?",
            "Explain SEO tools.",
            "What are content delivery networks (CDNs)?",
            "How to secure a website?",
            "Tips for preventing cyber attacks.",
            "What is a firewall?",
            "How to use SSL certificates?",
            "Explain data encryption in web security.",
            "What are common web vulnerabilities?",
            "How to prevent SQL injection?",
            "Tips for preventing cross-site scripting (XSS).",
            "What is authentication and authorization?",
            "How to implement secure user logins?",
            "Explain password hashing.",
            "What are API security best practices?",
            "How to secure cloud applications?",
            "Tips for secure coding practices.",
            "What is penetration testing?",
            "How to conduct a security audit?",
            "Explain incident response plans.",
            "What are disaster recovery strategies?",
            "How to perform data backups and recovery?",
            "Tips for business continuity planning.",
            "What is IT governance?",
            "How to manage IT risks?",
            "Explain IT service management (ITSM).",
            "What are ITIL frameworks?",
            "How to manage IT projects?",
            "Tips for IT budgeting.",
            "What is cloud cost management?",
            "How to optimize cloud resources?",
            "Explain serverless computing.",
            "What are containerization technologies like Docker?",
            "How to use Kubernetes for orchestration?",
            "Tips for DevOps practices.",
            "What is continuous integration/continuous delivery (CI/CD)?",
            "How to automate software deployments?",
            "Explain infrastructure as code (IaC).",
            "What are security automation tools?",
            "How to implement DevSecOps?",
            "Tips for site reliability engineering (SRE).",
            "What is observability in software systems?",
            "How to monitor application performance?",
            "Explain logging and tracing.",
            "What are alert management systems?",
            "How to troubleshoot complex systems?",
            "Tips for incident post-mortems.",
            "What is chaos engineering?",
            "How to build resilient systems?",
            "Explain fault tolerance.",
            "What are distributed systems challenges?",
            "How to design scalable architectures?",
            "Tips for microservices architecture.",
            "What is event-driven architecture?",
            "How to use message queues?",
            "Explain data streaming technologies.",
            "What are database design principles?",
            "How to choose the right database?",
            "Tips for NoSQL databases.",
            "What is graph database?",
            "How to optimize database performance?",
            "Explain database security.",
            "What are data warehousing concepts?",
            "How to build a data lake?",
            "Tips for ETL processes.",
            "What is business intelligence dashboards?",
            "How to create interactive reports?",
            "Explain data storytelling.",
            "What are benefits of data governance?",
            "How to ensure data quality?",
            "Tips for data privacy regulations (e.g., CCPA, GDPR).",
            "What is ethical data use?",
            "How to prevent algorithmic bias?",
            "Explain responsible AI development.",
            "What are fairness metrics in machine learning?",
            "How to ensure AI transparency and explainability?",
            "Tips for AI auditing.",
            "What is federated learning?",
            "How to train AI models with privacy preservation?",
            "Explain differential privacy.",
            "What are synthetic data generation methods?",
            "How to secure machine learning models?",
            "Tips for adversarial machine learning.",
            "What is model interpretability?",
            "How to debug machine learning models?",
            "Explain model monitoring and maintenance.",
            "What is MLOps?",
            "How to deploy machine learning models in production?",
            "Tips for versioning machine learning models.",
            "What are machine learning platforms?",
            "How to use cloud AI services?",
            "Explain custom machine learning models.",
            "What are deep neural networks?",
            "How to train convolutional neural networks (CNNs)?",
            "Tips for recurrent neural networks (RNNs).",
            "What are transformers in NLP?",
            "How to fine-tune pre-trained models?",
            "Explain generative adversarial networks (GANs).",
            "What are reinforcement learning applications?",
            "How to build intelligent agents?",
            "Tips for natural language understanding (NLU).",
            "What is natural language generation (NLG)?",
            "How to perform sentiment analysis?",
            "Explain named entity recognition (NER).",
            "What are text summarization techniques?",
            "How to build a chatbot?",
            "Tips for voice assistants development.",
            "What is computer vision in robotics?",
            "How to use object detection models?",
            "Explain image segmentation.",
            "What are facial recognition technologies?",
            "How to apply computer vision in security?",
            "Tips for developing augmented reality (AR) applications.",
            "What is virtual reality (VR) for training?",
            "How to create immersive experiences?",
            "Explain mixed reality (MR).",
            "What are applications of VR/AR in healthcare?",
            "How to use AR for remote assistance?",
            "Tips for developing games with AR/VR.",
            "What is game design theory?",
            "How to create game mechanics?",
            "Explain level design.",
            "What are types of video game genres?",
            "How to monetize games?",
            "Tips for indie game development.",
            "What is game engine development?",
            "How to use Unity for game creation?",
            "Explain Unreal Engine.",
            "What are tools for 3D modeling?",
            "How to animate 3D characters?",
            "Tips for character rigging.",
            "What is texture mapping?",
            "How to optimize game assets?",
            "Explain game physics engines.",
            "What are artificial intelligence in games?",
            "How to design game AI?",
            "Tips for pathfinding algorithms.",
            "What is procedural content generation?",
            "How to implement networking in games?",
            "Explain multiplayer game architectures.",
            "What are security considerations for online games?",
            "How to prevent cheating in games?",
            "Tips for game testing and quality assurance.",
            "What is game localization?",
            "How to market a video game?",
            "Explain esports and competitive gaming.",
            "What are streaming platforms for games?",
            "How to become a professional gamer?",
            "Tips for content creation as a streamer.",
            "What is game development boot camp?",
            "How to learn game programming?",
            "Explain game art and animation courses.",
            "What are sound design principles for games?",
            "How to compose game music?",
            "Tips for writing game narratives.",
            "What is world-building in games?",
            "How to create compelling game characters?",
            "Explain branching narratives in games.",
            "What are interactive storytelling techniques?",
            "How to design puzzle games?",
            "Tips for educational game design.",
            "What is serious games development?",
            "How to use games for training and simulation?",
            "Explain gamification in business.",
            "What are elements of gamification?",
            "How to apply gamification to education?",
            "Tips for designing reward systems.",
            "What is behavioral economics?",
            "How to influence user behavior ethically?",
            "Explain nudges in design.",
            "What are ethical considerations in persuasive design?",
            "How to design for positive habits?",
            "Tips for breaking bad habits.",
            "What is habit formation theory?",
            "How to use triggers, routines, and rewards?",
            "Explain the Fogg Behavior Model.",
            "What is the power of small wins?",
            "How to build self-efficacy?",
            "Tips for setting challenging but achievable goals.",
            "What is deliberate practice?",
            "How to learn from failures?",
            "Explain resilience and grit.",
            "What are characteristics of successful people?",
            "How to develop a growth mindset?",
            "Tips for cultivating emotional intelligence.",
            "What is positive psychology in practice?",
            "How to find your purpose in life?",
            "Explain meaning-making.",
            "What are values-based living principles?",
            "How to align actions with values?",
            "Tips for cultivating gratitude.",
            "What is forgiveness and its benefits?",
            "How to practice self-compassion?",
            "Explain the power of mindfulness.",
            "What are meditation techniques for stress relief?",
            "How to cultivate inner peace?",
            "Tips for managing anxiety and worry.",
            "What is cognitive restructuring?",
            "How to challenge negative thoughts?",
            "Explain behavioral activation.",
            "What are coping skills for depression?",
            "How to build a support system?",
            "Tips for effective communication in relationships.",
            "What is active listening?",
            "How to resolve conflicts constructively?",
            "Explain empathetic responding.",
            "What are healthy boundaries in relationships?",
            "How to build trust and intimacy?",
            "Tips for navigating difficult conversations.",
            "What is nonviolent communication?",
            "How to express needs clearly?",
            "Explain the impact of body language.",
            "What are signs of healthy attachment?",
            "How to heal from relationship trauma?",
            "Tips for self-love and self-respect.",
            "What is emotional regulation?",
            "How to manage strong emotions?",
            "Explain distress tolerance skills.",
            "What are mindfulness-based stress reduction techniques?",
            "How to practice radical acceptance?",
            "Tips for building resilience after trauma.",
            "What is post-traumatic growth?",
            "How to seek professional help for mental health?",
            "Explain different types of therapy.",
            "What are benefits of counseling?",
            "How to find a good therapist?",
            "Tips for medication management for mental health.",
            "What is crisis intervention?",
            "How to support someone in crisis?",
            "Explain suicide prevention strategies.",
            "What are signs of addiction?",
            "How to seek help for substance use disorder?",
            "Tips for recovery and relapse prevention.",
            "What is harm reduction?",
            "How to support a loved one with addiction?",
            "Explain codependency.",
            "What are boundaries for healthy relationships?",
            "How to practice self-care to prevent burnout?",
            "Tips for managing work-life balance.",
            "What is digital detox?",
            "How to create a healthy relationship with technology?",
            "Explain conscious consumption.",
            "What are sustainable living practices?",
            "How to reduce your environmental footprint?",
            "Tips for mindful eating.",
            "What is intuitive eating?",
            "How to foster positive body image?",
            "Explain healthy lifestyle choices.",
            "What are benefits of physical activity?",
            "How to incorporate exercise into your routine?",
            "Tips for improving sleep hygiene.",
            "What is stress management?",
            "How to practice relaxation techniques?",
            "Explain the importance of hydration.",
            "What are superfoods?",
            "How to boost your immune system naturally?",
            "Tips for maintaining gut health.",
            "What is the microbiome?",
            "How to reduce inflammation through diet?",
            "Explain chronic disease prevention.",
            "What are benefits of preventative care?",
            "How to manage chronic conditions?",
            "Tips for healthy aging.",
            "What is brain health?",
            "How to prevent cognitive decline?",
            "Explain neuroplasticity and learning.",
            "What are memory-boosting techniques?",
            "How to improve focus and concentration?",
            "Tips for lifelong learning.",
            "What is intellectual curiosity?",
            "How to stay mentally active?",
            "Explain the power of reading.",
            "What are benefits of learning a new language?",
            "How to play brain games?",
            "Tips for creative problem-solving.",
            "What is divergent thinking?",
            "How to foster innovation?",
            "Explain design thinking process.",
            "What are ideation techniques?",
            "How to brainstorm effectively?",
            "Tips for overcoming creative blocks.",
            "What is artistic expression?",
            "How to find your creative outlet?",
            "Explain the benefits of hobbies.",
            "What are ways to relax and de-stress?",
            "How to enjoy leisure time fully?",
            "Tips for finding joy in everyday life.",
            "What is the pursuit of happiness?",
            "How to cultivate optimism?",
            "Explain resilience in challenging times.",
            "What is post-traumatic growth?",
            "How to build meaningful relationships?",
            "Tips for fostering connection.",
            "What is the importance of community?",
            "How to give back to society?",
            "Explain philanthropy and altruism.",
            "What are different forms of volunteering?",
            "How to make a positive impact?",
            "Tips for advocacy and activism.",
            "What is social justice?",
            "How to promote equality and equity?",
            "Explain human rights.",
            "What are ethical dilemmas?",
            "How to make ethical decisions?",
            "Tips for moral reasoning.",
            "What is critical thinking in daily life?",
            "How to analyze information effectively?",
            "Explain logical fallacies.",
            "What are biases in thinking?",
            "How to avoid misinformation?",
            "Tips for media literacy.",
            "What is responsible digital citizenship?",
            "How to manage your online presence?",
            "Explain cyber security for individuals.",
            "What are common online scams?",
            "How to protect your privacy online?",
            "Tips for strong password creation.",
            "What is two-factor authentication (2FA)?",
            "How to recognize phishing emails?",
            "Explain identity theft prevention.",
            "What are VPNs and why use them?",
            "How to secure your smart home devices?",
            "Tips for safe online shopping.",
            "What is data breach notification?",
            "How to respond to a data breach?",
            "Explain ransomware attacks.",
            "What are computer viruses and malware?",
            "How to keep your software updated?",
            "Tips for secure Wi-Fi usage.",
            "What is public Wi-Fi safety?",
            "How to use a password manager?",
            "Explain digital footprint.",
            "What are privacy settings on social media?",
            "How to delete personal data online?",
            "Tips for managing online reputation.",
            "What is cancel culture?",
            "How to navigate online discourse responsibly?",
            "Explain digital well-being.",
            "What is screen time management?",
            "How to reduce digital distractions?",
            "Tips for a healthy relationship with social media.",
            "What is social media addiction?",
            "How to do a digital detox?",
            "Explain tech-life balance.",
            "What are benefits of unplugging?",
            "How to foster real-world connections?",
            "Tips for intentional technology use.",
            "What is slow living?",
            "How to embrace simplicity?",
            "Explain mindful consumption.",
            "What are benefits of decluttering?",
            "How to organize your home effectively?",
            "Tips for minimalist living.",
            "What is zero-waste lifestyle?",
            "How to reduce plastic waste?",
            "Explain composting at home.",
            "What are sustainable fashion choices?",
            "How to reduce your carbon footprint?",
            "Tips for energy conservation.",
            "What is renewable energy at home?",
            "How to grow your own food?",
            "Explain urban gardening.",
            "What are permaculture principles?",
            "How to support local food systems?",
            "Tips for ethical eating.",
            "What is plant-based diet?",
            "How to reduce meat consumption?",
            "Explain sustainable seafood choices.",
            "What are benefits of buying local?",
            "How to support fair trade products?",
            "Tips for eco-friendly transportation.",
            "What is active transportation?",
            "How to use public transit efficiently?",
            "Explain electric vehicles (EVs).",
            "What are benefits of biking?",
            "How to make your home more energy efficient?",
            "Tips for water conservation at home.",
            "What is rain harvesting?",
            "How to reduce water waste?",
            "Explain responsible waste management.",
            "What are recycling best practices?",
            "How to dispose of hazardous waste?",
            "Tips for preventing pollution.",
            "What is air quality monitoring?",
            "How to reduce indoor air pollution?",
            "Explain noise pollution effects.",
            "What are light pollution solutions?",
            "How to protect biodiversity?",
            "Tips for wildlife conservation.",
            "What is habitat restoration?",
            "How to support endangered species?",
            "Explain the impact of climate change on ecosystems.",
            "What are climate change mitigation strategies?",
            "How to adapt to climate change impacts?",
            "Tips for climate resilience.",
            "What is carbon sequestration?",
            "How to promote reforestation?",
            "Explain sustainable forestry.",
            "What are ocean conservation efforts?",
            "How to reduce plastic in oceans?",
            "Tips for marine life protection.",
            "What is coral reef conservation?",
            "How to prevent overfishing?",
            "Explain sustainable fisheries.",
            "What are wetlands restoration projects?",
            "How to protect freshwater sources?",
            "Tips for water quality improvement.",
            "What is environmental justice?",
            "How to address environmental racism?",
            "Explain indigenous environmental knowledge.",
            "What are traditional ecological practices?",
            "How to integrate indigenous perspectives in conservation?",
            "Tips for citizen advocacy for environmental issues.",
            "What is environmental policy?",
            "How to engage with local government on environmental issues?",
            "Explain international environmental agreements.",
            "What are green technologies?",
            "How to invest in renewable energy?",
            "Tips for sustainable finance.",
            "What is impact investing?",
            "How to measure environmental social governance (ESG) performance?",
            "Explain corporate sustainability reporting.",
            "What are green jobs?",
            "How to pursue a career in sustainability?",
            "Tips for environmental education.",
            "What is outdoor learning?",
            "How to connect children with nature?",
            "Explain nature-based solutions.",
            "What are urban green spaces?",
            "How to design sustainable cities?",
            "Tips for community gardening.",
            "What is food sovereignty?",
            "How to promote local food systems?",
            "Explain resilient food systems.",
            "What are permaculture design principles?",
            "How to build a food forest?",
            "Tips for zero-waste cooking.",
            "What is food waste reduction?",
            "How to compost food scraps?",
            "Explain circular economy models for food.",
            "What are sustainable agriculture practices?",
            "How to support regenerative farming?",
            "Tips for ethical eating choices."
        ];

        // --- DOM Elements (Declared here, assigned in load event) ---
        let chatbotContainer;
        let chatHistoryDiv;
        let userInput;
        let sendButton;
        let darkModeToggle;
        let copyMessage;
        let newChatBtn;
        let chatAttachmentsPreviewContainer;
        let chatImageUpload;
        let voiceInputBtn;
        let suggestionsContainer;
        let suggestionsList;

        // --- Lucide Icon Helper ---
        const createIcons = () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        };

        function updateButtonIcon(buttonElement, newIconName, classList = 'w-4 h-4') {
            let currentIconSvg = buttonElement.querySelector('.lucide');
            if (currentIconSvg) {
                currentIconSvg.remove();
            }

            const newIconSpan = document.createElement('span');
            newIconSpan.setAttribute('data-lucide', newIconName);
            newIconSpan.className = classList; 

            buttonElement.appendChild(newIconSpan);
           
            createIcons(); 
        }

        // --- File Handling Helpers ---
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve({
                    mimeType: file.type || 'application/octet-stream', 
                    data: reader.result.split(',')[1]
                });
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        };

        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'image';
            if (mimeType === 'application/pdf') return 'file-text';
            if (mimeType.includes('text/')) return 'file-text';
            if (mimeType.includes('csv') || mimeType.includes('excel')) return 'file-spreadsheet';
            if (mimeType.includes('json') || mimeType.includes('xml') || mimeType.includes('code') || mimeType.includes('markdown')) return 'file-code';
            return 'file';
        }

        // --- Markdown.js Custom Renderer for Code Blocks ---
        const renderer = {
            code(token) { 
                const actualCodeContent = token.text; 
                const lang = token.lang;             

                const languageDisplay = lang ? `<span class="text-xs font-semibold uppercase text-gray-400">${lang}</span>` : '';
                const uniqueId = `code-block-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                
                const escapedCode = actualCodeContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');

                return `
                    <div class="code-block-container">
                        <div class="code-block-header">
                            ${languageDisplay}
                            <button class="code-block-copy-button" data-copy-target="${uniqueId}">
                                <span data-lucide="clipboard" class="w-4 h-4"></span>
                                Copy code
                            </button>
                        </div>
                        <pre><code id="${uniqueId}">${escapedCode}</code></pre>
                    </div>
                `;
            }
        };
        marked.use({ renderer });

        // --- Chat UI & Logic ---
        function appendChatMessage(role, text, attachments = []) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('chat-message', role);
            
            const messageId = `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            messageDiv.dataset.messageId = messageId;
            
            let contentHTML = '';
            let rawMessageContentForCache = ''; 

            if (role === 'user') {
                rawMessageContentForCache = `You: ${text}`;
                contentHTML += `<span class="font-bold">You:</span> ${text}`;
                if (attachments.length > 0) {
                    contentHTML += `<div class="mt-2 flex flex-wrap gap-2">`;
                    attachments.forEach(attachment => {
                        if (attachment.mimeType.startsWith('image/')) {
                            contentHTML += `<img src="data:${attachment.mimeType};base64,${attachment.data}" alt="${attachment.name || 'User attachment'}" class="chat-image w-24 h-24 object-cover">`;
                        } else {
                            contentHTML += `
                                <div class="chat-message-attachment-item">
                                    <span data-lucide="${getFileIcon(attachment.mimeType)}" class="w-4 h-4 flex-shrink-0"></span>
                                    <span class="truncate max-w-[120px]">${attachment.name || 'File'}</span>
                                </div>
                            `;
                        }
                    });
                    contentHTML += `</div>`;
                    rawMessageContentForCache += `\n[Attachments: ${attachments.map(a => a.name).join(', ')}]`;
                }
            } else { 
                rawMessageContentForCache = `AI: ${text}`;
                contentHTML = `<div class="message-content">${marked.parse(text)}</div>`;
            }
            
            messageTextCache.set(messageId, rawMessageContentForCache); 

            const actionsHTML = `
                <div class="message-actions">
                    <button class="copy-message-btn" title="Copy message" data-message-id="${messageId}">
                        <span data-lucide="clipboard" class="w-4 h-4"></span>
                    </button>
                    <button class="dictate-message-btn" title="Dictate message" data-message-id="${messageId}">
                        <span data-lucide="volume-2" class="w-4 h-4"></span>
                    </button>
                </div>
            `;
            
            messageDiv.innerHTML = contentHTML + actionsHTML;
            chatHistoryDiv.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.transform = 'scale(1)';
            }, 10);
            
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
            
            createIcons(); 
        }

        function toggleLoading(show) {
            let loadingIndicator = document.getElementById('loadingIndicator');
            if (show) {
                if (!loadingIndicator) {
                    loadingIndicator = document.createElement('div');
                    loadingIndicator.id = 'loadingIndicator';
                    loadingIndicator.classList.add('p-4', 'text-center', 'text-gray-500', 'text-sm', 'ai-message'); 
                    loadingIndicator.innerHTML = `
                        <div class="loader-container h-8">
                            <div class="loader-dot"></div>
                            <div class="loader-dot"></div>
                            <div class="loader-dot"></div>
                        </div>
                        <span class="mt-2 block">AI is typing...</span>
                    `;
                    chatHistoryDiv.appendChild(loadingIndicator);
                }
                loadingIndicator.style.display = 'flex';
                loadingIndicator.style.flexDirection = 'column'; 
                chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
            } else {
                if (loadingIndicator) {
                    loadingIndicator.remove(); 
                }
            }
        }

        function displayChatAttachments() {
            chatAttachmentsPreviewContainer.innerHTML = '';
            if (chatAttachments.length > 0) {
                chatAttachmentsPreviewContainer.classList.remove('hidden');
                chatAttachments.forEach((attachment, index) => {
                    const attachmentDiv = document.createElement('div');
                    attachmentDiv.classList.add('chat-attachment-preview-item');
                    attachmentDiv.dataset.index = index;

                    let previewContent = '';
                    if (attachment.mimeType.startsWith('image/')) {
                        previewContent = `<img src="data:${attachment.mimeType};base64,${attachment.data}" alt="${attachment.name}" class="w-8 h-8 object-cover rounded-md">`;
                    } else {
                        previewContent = `<span data-lucide="${getFileIcon(attachment.mimeType)}" class="w-5 h-5 flex-shrink-0"></span>`;
                    }

                    attachmentDiv.innerHTML = `
                        ${previewContent}
                        <span class="truncate max-w-[100px]">${attachment.name}</span>
                        <button class="remove-attachment-btn">
                            <span data-lucide="x" class="w-4 h-4"></span>
                        </button>
                    `;
                    chatAttachmentsPreviewContainer.appendChild(attachmentDiv);
                });
                createIcons(); 
            } else {
                chatAttachmentsPreviewContainer.classList.add('hidden');
            }
        }

        function showCopyMessage() {
            copyMessage.classList.add('show');
            setTimeout(() => {
                copyMessage.classList.remove('show');
            }, 3000);
        }

        function copyToClipboard(text) { 
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text)
                    .then(() => {
                        showCopyMessage();
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('Failed to copy text. Please copy manually.'); 
                    });
            } else {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = text;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    document.execCommand('copy');
                    showCopyMessage();
                } catch (err) {
                    console.error('Failed to copy (fallback):', err);
                    alert('Failed to copy text. Please copy manually.'); 
                }
                document.body.removeChild(tempTextArea);
            }
        }

        function toggleSpeech(text, buttonElement) {
            if (!window.speechSynthesis) {
                alert('Speech synthesis not supported in this browser.');
                return;
            }

            if (isSpeaking && currentUtterance && currentUtterance.text === text) {
                if (window.speechSynthesis.paused) {
                    window.speechSynthesis.resume();
                    updateButtonIcon(buttonElement, 'pause');
                } else {
                    window.speechSynthesis.pause();
                    updateButtonIcon(buttonElement, 'volume-2');
                }
            } else {
                startSpeech(text, buttonElement);
            }
        }

        function startSpeech(text, buttonElement) {
            if (window.speechSynthesis.speaking || window.speechSynthesis.paused) {
                window.speechSynthesis.cancel();
            }

            document.querySelectorAll('.dictate-message-btn').forEach(btn => {
                if (btn !== buttonElement) { 
                    updateButtonIcon(btn, 'volume-2'); 
                }
            });

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US'; 

            utterance.onstart = () => {
                isSpeaking = true;
                currentUtterance = utterance;
                updateButtonIcon(buttonElement, 'pause');
            };
            utterance.onend = () => {
                isSpeaking = false;
                currentUtterance = null;
                updateButtonIcon(buttonElement, 'volume-2');
            };
            utterance.onerror = (event) => {
                console.error('Speech synthesis error:', event.error);
                alert('Failed to dictate message. Check console for details.');
                isSpeaking = false;
                currentUtterance = null;
                updateButtonIcon(buttonElement, 'volume-2');
            };

            window.speechSynthesis.speak(utterance);
        }

        // --- API Call Function ---
        async function callGeminiAPI(payload) {
            if (GEMINI_API_KEY === "YOUR_GEMINI_API_KEY_HERE" || !GEMINI_API_KEY || GEMINI_API_KEY === "") { 
                throw new Error("API Key is not set or is the default placeholder. Please replace 'YOUR_GEMINI_API_KEY_HERE' in the script with your actual Gemini API key.");
            }

            let response;
            let result;
            let success = false;
            let retryCount = 0;
            const maxRetries = 3;
            let delay = 1000; 

            while (retryCount < maxRetries && !success) {
                try {
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { 
                        if (retryCount < maxRetries - 1) {
                            console.warn(`API rate limit exceeded. Retrying in ${delay / 1000}s...`);
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2; 
                            retryCount++;
                        } else {
                            throw new Error('API rate limit exceeded. Please try again later.');
                        }
                    } else if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${response.status} ${response.statusText} - ${errorData.error?.message || 'Unknown error'}`);
                    } else {
                        result = await response.json();
                        success = true;
                    }
                } catch (err) {
                    if (retryCount < maxRetries - 1) {
                        console.warn(`Fetch error: ${err.message}. Retrying in ${delay / 1000}s...`);
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                        retryCount++;
                    } else {
                        throw err; 
                    }
                }
            }
            
            if (result && result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                throw new Error('Failed to get a valid response from the AI. No candidates found or content is empty.');
            }
        }

        // --- Autocomplete Functions ---
        function filterSuggestions(query) {
            if (!query) return [];
            const lowerQuery = query.toLowerCase();
            return autocompleteSuggestions.filter(s => s.toLowerCase().includes(lowerQuery));
        }

        function displaySuggestions(suggestions) {
            suggestionsList.innerHTML = '';
            suggestionsContainer.classList.add('hidden');
            selectedSuggestionIndex = -1;

            if (suggestions.length === 0) {
                return;
            }

            suggestions.forEach((suggestion, index) => {
                const li = document.createElement('li');
                li.textContent = suggestion;
                li.dataset.index = index;
                li.addEventListener('click', () => {
                    userInput.value = suggestion;
                    userInput.focus();
                    suggestionsContainer.classList.add('hidden');
                    userInput.style.height = 'auto'; 
                    userInput.style.height = userInput.scrollHeight + 'px';
                });
                suggestionsList.appendChild(li);
            });
            suggestionsContainer.classList.remove('hidden');
        }

        function navigateSuggestions(direction) {
            const items = Array.from(suggestionsList.children);
            if (items.length === 0) return;

            if (selectedSuggestionIndex !== -1) {
                items[selectedSuggestionIndex].classList.remove('selected');
            }

            if (direction === 'down') {
                selectedSuggestionIndex = (selectedSuggestionIndex + 1) % items.length;
            } else if (direction === 'up') {
                selectedSuggestionIndex = (selectedSuggestionIndex - 1 + items.length) % items.length;
            }

            items[selectedSuggestionIndex].classList.add('selected');
            items[selectedSuggestionIndex].scrollIntoView({ block: 'nearest' });
            userInput.value = items[selectedSuggestionIndex].textContent; // Auto-fill on arrow key
            userInput.style.height = 'auto'; 
            userInput.style.height = userInput.scrollHeight + 'px';
        }

        function selectCurrentSuggestion() {
            if (selectedSuggestionIndex !== -1) {
                const selectedText = suggestionsList.children[selectedSuggestionIndex].textContent;
                userInput.value = selectedText;
            }
            suggestionsContainer.classList.add('hidden');
            selectedSuggestionIndex = -1;
        }

        // --- New Chat Function ---
        function startNewChat() {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
                isSpeaking = false;
                currentUtterance = null;
                document.querySelectorAll('.dictate-message-btn').forEach(btn => updateButtonIcon(btn, 'volume-2'));
            }

            chatHistoryDiv.innerHTML = ''; // Clear existing messages
            conversationHistory = []; // Reset conversation history
            chatAttachments = []; // Clear attachments
            chatImageUpload.value = ''; // Clear file input
            displayChatAttachments(); // Hide attachment preview
            userInput.value = '';
            userInput.style.height = 'auto'; 
            messageTextCache.clear(); // Clear message text cache
            suggestionsContainer.classList.add('hidden'); // Hide suggestions
            selectedSuggestionIndex = -1;

            // Add the initial AI message
            conversationHistory.push(initialAIMessage);
            appendChatMessage('ai', initialAIMessage.parts[0].text);
            
            userInput.focus();
        }

        // --- Paste Functionality ---
        async function processPastedFile(file) {
            const allowedTypes = [
                'image/', 'text/', 'application/pdf',
                'application/json', 'text/csv', 'application/xml', 'text/markdown'
            ];
            const isAllowed = allowedTypes.some(type => file.type.startsWith(type)) || file.name.endsWith('.md');

            if (isAllowed) {
                if (file.size > 10 * 1024 * 1024) { 
                    alert(`File "${file.name}" is too large (>10MB). Max 10MB per file.`);
                    return;
                }
                try {
                    const { mimeType, data } = await fileToBase64(file);
                    chatAttachments.push({ file, mimeType, data, name: file.name });
                } catch (error) {
                    alert(`Failed to read pasted file ${file.name}.`);
                    console.error('Pasted file read error:', error);
                }
            } else {
                alert(`Pasted file type not supported: "${file.name}" (${file.type}).`);
            }
        }

        // --- Initialization on Load ---
        window.addEventListener('load', () => {
            // --- Assign DOM Elements after the page is fully loaded ---
            chatbotContainer = document.querySelector('.chatbot-container');
            chatHistoryDiv = document.getElementById('chatHistory');
            userInput = document.getElementById('userInput');
            sendButton = document.getElementById('sendButton');
            darkModeToggle = document.getElementById('dark-mode-toggle');
            copyMessage = document.getElementById('copy-message');
            newChatBtn = document.getElementById('newChatBtn');
            chatAttachmentsPreviewContainer = document.getElementById('chat-attachments-preview-container');
            chatImageUpload = document.getElementById('chat-image-upload');
            voiceInputBtn = document.getElementById('voice-input-btn');
            suggestionsContainer = document.getElementById('suggestions-container');
            suggestionsList = document.getElementById('suggestions-list');

            createIcons();
            userInput.style.height = userInput.scrollHeight + 'px';

            // Initialize Dark Mode based on localStorage or default
            const isDarkMode = localStorage.getItem('dark-mode') === 'true';
            document.body.classList.toggle('light', !isDarkMode); // Toggle light class based on dark mode status
            darkModeToggle.checked = isDarkMode;

            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registered: ', registration);
                })
                .catch(registrationError => {
                    console.log('ServiceWorker registration failed: ', registrationError);
                });
            }

            // Start a new chat on load to display initial message
            startNewChat();

            // --- Speech Recognition Setup (Must be inside load to ensure voiceInputBtn exists) ---
            if (SpeechRecognition) {
                recognition = new SpeechRecognition();
                recognition.continuous = true; 
                recognition.interimResults = true; 
                recognition.lang = 'en-US';

                recognition.onstart = () => {
                    isVoiceInputActive = true;
                    voiceInputBtn.classList.add('voice-input-active');
                    updateButtonIcon(voiceInputBtn, 'mic-off', 'w-5 h-5'); 
                    userInput.placeholder = 'Listening... Speak now.';
                    finalTranscript = ''; 
                    userInput.value = ''; 
                };

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript + ' '; 
                        } else {
                            interimTranscript += event.results[i][0].transcript;
                        }
                    }
                    userInput.value = finalTranscript + interimTranscript; 
                    userInput.scrollLeft = userInput.scrollWidth; 
                    userInput.style.height = 'auto'; 
                    userInput.style.height = userInput.scrollHeight + 'px';
                };

                recognition.onend = () => {
                    isVoiceInputActive = false;
                    voiceInputBtn.classList.remove('voice-input-active');
                    updateButtonIcon(voiceInputBtn, 'mic', 'w-5 h-5'); 
                    userInput.placeholder = 'Type your message...';

                    if (finalTranscript.trim() !== '') {
                        userInput.value = finalTranscript.trim(); 
                    } else if (userInput.value.trim() === '') {
                        userInput.value = ''; 
                    }
                    userInput.style.height = 'auto'; 
                    userInput.style.height = userInput.scrollHeight + 'px';
                };

                recognition.onerror = (event) => {
                    isVoiceInputActive = false; 
                    voiceInputBtn.classList.remove('voice-input-active');
                    updateButtonIcon(voiceInputBtn, 'mic', 'w-5 h-5'); 
                    userInput.placeholder = 'Type your message...';

                    console.error('Speech recognition error:', event.error);
                    let errorMessage = `Speech recognition error: ${event.error}`;
                    if (event.error === 'not-allowed') {
                        errorMessage = 'Microphone access denied. Please allow microphone access in your browser settings.';
                    } else if (event.error === 'no-speech') {
                        console.log('No speech detected, recognition ended.');
                        if (finalTranscript.trim() === '') { userInput.value = ''; }
                        return; 
                    } else if (event.error === 'network') {
                        errorMessage = 'Speech recognition network error. This often means a firewall, proxy, or browser extension is blocking access to Google\'s speech services. Please try disabling extensions or testing in incognito mode.';
                    }
                    alert(errorMessage); 
                };
            } else {
                console.warn('Web Speech API (SpeechRecognition) not supported in this browser. Voice input button will be hidden.');
                voiceInputBtn.style.display = 'none'; 
            }

            // --- Event Listeners (Must be attached after elements are assigned) ---
            darkModeToggle.addEventListener('change', () => {
                const isChecked = darkModeToggle.checked;
                document.body.classList.toggle('light', !isChecked);
                localStorage.setItem('dark-mode', isChecked);
            });

            userInput.addEventListener('input', () => {
                userInput.style.height = 'auto'; 
                userInput.style.height = userInput.scrollHeight + 'px';

                const query = userInput.value;
                if (query.length > 0) {
                    const suggestions = filterSuggestions(query);
                    displaySuggestions(suggestions);
                } else {
                    suggestionsContainer.classList.add('hidden');
                }
            });

            userInput.addEventListener('keydown', (e) => {
                if (suggestionsContainer.classList.contains('hidden')) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault(); 
                    navigateSuggestions('down');
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault(); 
                    navigateSuggestions('up');
                } else if (e.key === 'Enter' && selectedSuggestionIndex !== -1) {
                    e.preventDefault(); 
                    selectCurrentSuggestion();
                } else if (e.key === 'Escape') {
                    suggestionsContainer.classList.add('hidden');
                    selectedSuggestionIndex = -1;
                }
            });

            userInput.addEventListener('blur', () => {
                setTimeout(() => {
                    suggestionsContainer.classList.add('hidden');
                    selectedSuggestionIndex = -1;
                }, 100); 
            });

            userInput.addEventListener('paste', async (e) => {
                const items = e.clipboardData.items;
                let filePasted = false;

                for (let i = 0; i < items.length; i++) {
                    const item = items[i];
                    if (item.kind === 'file') {
                        e.preventDefault(); 
                        const file = item.getAsFile();
                        if (file) {
                            filePasted = true;
                            await processPastedFile(file);
                        }
                    }
                }

                if (filePasted) {
                    displayChatAttachments();
                    userInput.focus();
                }
            });

            sendButton.addEventListener('click', async () => {
                const userMessage = userInput.value.trim();
                if (!userMessage && chatAttachments.length === 0) {
                    return;
                }
                
                if (isVoiceInputActive && recognition) {
                    recognition.stop();
                }

                const userParts = [];
                if (userMessage) {
                    userParts.push({ text: userMessage });
                }
                for (const attachment of chatAttachments) {
                    userParts.push({
                        inlineData: {
                            mimeType: attachment.mimeType,
                            data: attachment.data
                        }
                    });
                }

                conversationHistory.push({ role: 'user', parts: userParts });
                appendChatMessage('user', userMessage, chatAttachments);
                
                userInput.value = '';
                userInput.style.height = 'auto'; 
                chatAttachments = [];
                chatImageUpload.value = ''; 
                displayChatAttachments(); 
                suggestionsContainer.classList.add('hidden'); 
                selectedSuggestionIndex = -1;
                
                sendButton.disabled = true;
                
                toggleLoading(true);
                
                try {
                    const payload = {
                        contents: conversationHistory,
                    };
                    
                    const responseText = await callGeminiAPI(payload);
                    
                    conversationHistory.push({ role: 'model', parts: [{ text: responseText }] });
                    appendChatMessage('ai', responseText);
                    
                } catch (error) {
                    console.error('Chat API call failed:', error);
                    appendChatMessage('ai', `Oops! Something went wrong. Please try again. (${error.message})`);
                } finally {
                    sendButton.disabled = false;
                    toggleLoading(false);
                    userInput.focus();
                }
            });
            
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { 
                    e.preventDefault(); 
                    if (selectedSuggestionIndex === -1) {
                        sendButton.click();
                    }
                }
            });

            chatImageUpload.addEventListener('change', async (event) => {
                const files = Array.from(event.target.files);
                if (files.length > 0) {
                    for (const file of files) {
                        const allowedTypes = [
                            'image/', 'text/', 'application/pdf',
                            'application/json', 'text/csv', 'application/xml', 'text/markdown'
                        ];
                        const isAllowed = allowedTypes.some(type => file.type.startsWith(type)) || file.name.endsWith('.md');

                        if (isAllowed) {
                            if (file.size > 10 * 1024 * 1024) { 
                                alert(`File "${file.name}" is too large (>${10}MB). Max 10MB per file.`);
                                continue;
                            }
                            try {
                                const { mimeType, data } = await fileToBase64(file);
                                chatAttachments.push({ file, mimeType, data, name: file.name });
                            } catch (error) {
                                alert(`Failed to read chat file ${file.name}.`);
                                console.error('Chat file read error:', error);
                            }
                        } else {
                            alert(`File type not supported for chat: "${file.name}" (${file.type}).`);
                        }
                    }
                    displayChatAttachments();
                    userInput.focus();
                }
                chatImageUpload.value = ''; 
            });

            chatAttachmentsPreviewContainer.addEventListener('click', (event) => {
                const removeBtn = event.target.closest('.remove-attachment-btn');
                if (removeBtn) {
                    const attachmentDiv = removeBtn.closest('[data-index]');
                    if (attachmentDiv) {
                        const index = parseInt(attachmentDiv.dataset.index);
                        chatAttachments.splice(index, 1); 
                        displayChatAttachments(); 
                        userInput.focus();
                    }
                }
            });

            voiceInputBtn.addEventListener('click', () => {
                if (recognition) {
                    if (isVoiceInputActive) {
                        recognition.stop(); 
                    } else {
                        finalTranscript = ''; 
                        recognition.start();
                    }
                } else {
                    alert('Speech recognition is not supported in this browser.');
                }
            });

            chatbotContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.stopPropagation();
                chatbotContainer.classList.add('drag-over-active');
            });

            chatbotContainer.addEventListener('dragleave', (e) => {
                e.preventDefault();
                e.stopPropagation();
                chatbotContainer.classList.remove('drag-over-active');
            });

            chatbotContainer.addEventListener('drop', async (e) => {
                e.preventDefault();
                e.stopPropagation();
                chatbotContainer.classList.remove('drag-over-active');

                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    for (const file of files) {
                        const allowedTypes = [
                            'image/', 'text/', 'application/pdf',
                            'application/json', 'text/csv', 'application/xml', 'text/markdown'
                        ];
                        const isAllowed = allowedTypes.some(type => file.type.startsWith(type)) || file.name.endsWith('.md');

                        if (isAllowed) {
                            if (file.size > 10 * 1024 * 1024) { 
                                alert(`File "${file.name}" is too large (>${10}MB). Max 10MB per file.`);
                                continue;
                            }
                            try {
                                const { mimeType, data } = await fileToBase64(file);
                                chatAttachments.push({ file, mimeType, data, name: file.name });
                            } catch (error) {
                                alert(`Failed to read chat file ${file.name}.`);
                                console.error('Chat file read error:', error);
                            }
                        } else {
                            alert(`File type not supported for chat: "${file.name}" (${file.type}).`);
                        }
                    }
                    displayChatAttachments();
                    userInput.focus();
                }
            });
            
            chatHistoryDiv.addEventListener('click', (event) => {
                const codeCopyButton = event.target.closest('.code-block-copy-button');
                if (codeCopyButton) {
                    const targetId = codeCopyButton.dataset.copyTarget;
                    const codeElement = document.getElementById(targetId);
                    if (codeElement) {
                        const codeToCopy = codeElement.textContent;
                        updateButtonIcon(codeCopyButton, 'check', 'w-4 h-4'); 
                        copyToClipboard(codeToCopy); 
                        setTimeout(() => { 
                            updateButtonIcon(codeCopyButton, 'clipboard', 'w-4 h-4'); 
                        }, 2000);
                        return; 
                    }
                }

                const chatCopyButton = event.target.closest('.copy-message-btn');
                if (chatCopyButton) {
                    const messageId = chatCopyButton.dataset.messageId;
                    const messageContent = messageTextCache.get(messageId);
                    if (messageContent) {
                        updateButtonIcon(chatCopyButton, 'check');
                        copyToClipboard(messageContent); 
                        setTimeout(() => { 
                            updateButtonIcon(chatCopyButton, 'clipboard');
                        }, 2000);
                    } else {
                        alert('Message content not found for copying.');
                    }
                    return; 
                }

                const dictateButton = event.target.closest('.dictate-message-btn');
                if (dictateButton) {
                    const messageId = dictateButton.dataset.messageId;
                    const messageContent = messageTextCache.get(messageId);
                    if (messageContent) {
                        toggleSpeech(messageContent, dictateButton);
                    } else {
                        alert('Message content not found for dictation.');
                    }
                    return; 
                }
            });

            // Event listener for the new chat button
            newChatBtn.addEventListener('click', startNewChat);
        });
    </script>
</body>
</html>
